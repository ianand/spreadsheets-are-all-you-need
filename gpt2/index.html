<!DOCTYPE html>

<html lang="en-US">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="http://gmpg.org/xfn/11" rel="profile"/>
<title>Spreadsheets (in Browsers) are all you need: GPT2 in your browser – Spreadsheets are all you need.ai</title>
<meta content="max-image-preview:large" name="robots">
<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
<link href="//fonts.googleapis.com" rel="dns-prefetch">
<link href="https://spreadsheets-are-all-you-need.ai/feed/" rel="alternate" title="Spreadsheets are all you need.ai » Feed" type="application/rss+xml"/>
<link href="https://spreadsheets-are-all-you-need.ai/comments/feed/" rel="alternate" title="Spreadsheets are all you need.ai » Comments Feed" type="application/rss+xml"/>
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/spreadsheets-are-all-you-need.ai\/wp-includes\/js\/wp-emoji-release.min.js"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\ud83d\udd25","\ud83d\udc26\u200b\ud83d\udd25")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link href="https://spreadsheets-are-all-you-need.ai/wp-includes/css/dist/block-library/style.min.css" id="wp-block-library-css" media="all" rel="stylesheet" type="text/css"/>
<style id="wp-block-library-theme-inline-css" type="text/css">
.wp-block-audio :where(figcaption){color:#555;font-size:13px;text-align:center}.is-dark-theme .wp-block-audio :where(figcaption){color:#ffffffa6}.wp-block-audio{margin:0 0 1em}.wp-block-code{border:1px solid #ccc;border-radius:4px;font-family:Menlo,Consolas,monaco,monospace;padding:.8em 1em}.wp-block-embed :where(figcaption){color:#555;font-size:13px;text-align:center}.is-dark-theme .wp-block-embed :where(figcaption){color:#ffffffa6}.wp-block-embed{margin:0 0 1em}.blocks-gallery-caption{color:#555;font-size:13px;text-align:center}.is-dark-theme .blocks-gallery-caption{color:#ffffffa6}:root :where(.wp-block-image figcaption){color:#555;font-size:13px;text-align:center}.is-dark-theme :root :where(.wp-block-image figcaption){color:#ffffffa6}.wp-block-image{margin:0 0 1em}.wp-block-pullquote{border-bottom:4px solid;border-top:4px solid;color:currentColor;margin-bottom:1.75em}.wp-block-pullquote cite,.wp-block-pullquote footer,.wp-block-pullquote__citation{color:currentColor;font-size:.8125em;font-style:normal;text-transform:uppercase}.wp-block-quote{border-left:.25em solid;margin:0 0 1.75em;padding-left:1em}.wp-block-quote cite,.wp-block-quote footer{color:currentColor;font-size:.8125em;font-style:normal;position:relative}.wp-block-quote:where(.has-text-align-right){border-left:none;border-right:.25em solid;padding-left:0;padding-right:1em}.wp-block-quote:where(.has-text-align-center){border:none;padding-left:0}.wp-block-quote.is-large,.wp-block-quote.is-style-large,.wp-block-quote:where(.is-style-plain){border:none}.wp-block-search .wp-block-search__label{font-weight:700}.wp-block-search__button{border:1px solid #ccc;padding:.375em .625em}:where(.wp-block-group.has-background){padding:1.25em 2.375em}.wp-block-separator.has-css-opacity{opacity:.4}.wp-block-separator{border:none;border-bottom:2px solid;margin-left:auto;margin-right:auto}.wp-block-separator.has-alpha-channel-opacity{opacity:1}.wp-block-separator:not(.is-style-wide):not(.is-style-dots){width:100px}.wp-block-separator.has-background:not(.is-style-dots){border-bottom:none;height:1px}.wp-block-separator.has-background:not(.is-style-wide):not(.is-style-dots){height:2px}.wp-block-table{margin:0 0 1em}.wp-block-table td,.wp-block-table th{word-break:normal}.wp-block-table :where(figcaption){color:#555;font-size:13px;text-align:center}.is-dark-theme .wp-block-table :where(figcaption){color:#ffffffa6}.wp-block-video :where(figcaption){color:#555;font-size:13px;text-align:center}.is-dark-theme .wp-block-video :where(figcaption){color:#ffffffa6}.wp-block-video{margin:0 0 1em}:root :where(.wp-block-template-part.has-background){margin-bottom:0;margin-top:0;padding:1.25em 2.375em}
</style>
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link href="https://fonts.googleapis.com/css?family=Raleway%3A400%2C500%2C600%2C700%2C300%2C100%2C800%2C900%7COpen+Sans%3A400%2C300%2C300italic%2C400italic%2C600%2C600italic%2C700%2C700italic&amp;subset=latin%2Clatin-ext&amp;display=swap&amp;ver=2.3.11" id="onepress-fonts-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/css/animate.min.css" id="onepress-animate-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/fontawesome-v6/css/all.min.css" id="onepress-fa-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/fontawesome-v6/css/v4-shims.min.css" id="onepress-fa-shims-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/css/bootstrap.min.css" id="onepress-bootstrap-css" media="all" rel="stylesheet" type="text/css"/>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/style.css" id="onepress-style-css" media="all" rel="stylesheet" type="text/css"/>
<style id="onepress-style-inline-css" type="text/css">
#main .video-section section.hero-slideshow-wrapper{background:transparent}.hero-slideshow-wrapper:after{position:absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(0,0,0,0.3);display:block;content:""}#parallax-hero .jarallax-container .parallax-bg:before{background-color:rgba(0,0,0,0.3)}.body-desktop .parallax-hero .hero-slideshow-wrapper:after{display:none!important}#parallax-hero>.parallax-bg::before{background-color:rgba(0,0,0,0.3);opacity:1}.body-desktop .parallax-hero .hero-slideshow-wrapper:after{display:none!important}.hero-content-style1 .morphext{background:#1e73be;padding:0px 20px;text-shadow:none;border-radius:3px}#footer-widgets{}.gallery-carousel .g-item{padding:0px 1px}.gallery-carousel-wrap{margin-left:-1px;margin-right:-1px}.gallery-grid .g-item,.gallery-masonry .g-item .inner{padding:1px}.gallery-grid-wrap,.gallery-masonry-wrap{margin-left:-1px;margin-right:-1px}.gallery-justified-wrap{margin-left:-2px;margin-right:-2px}
</style>
<link href="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/css/lightgallery.css" id="onepress-gallery-lightgallery-css" media="all" rel="stylesheet" type="text/css"/>
<script id="jquery-core-js" src="https://spreadsheets-are-all-you-need.ai/wp-includes/js/jquery/jquery.min.js" type="text/javascript"></script>
<script id="jquery-migrate-js" src="https://spreadsheets-are-all-you-need.ai/wp-includes/js/jquery/jquery-migrate.min.js" type="text/javascript"></script>
<link href="https://spreadsheets-are-all-you-need.ai/wp-json/" rel="https://api.w.org/"/><link href="https://spreadsheets-are-all-you-need.ai/wp-json/wp/v2/pages/102" rel="alternate" title="JSON" type="application/json"/>
<link href="https://spreadsheets-are-all-you-need.ai/gpt2/" rel="canonical"/>




<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style> <style id="wp-custom-css" type="text/css">
			/* Adjust font size for devices with a maximum width of 767px (commonly tablets and mobile devices) */
@media only screen and (max-width: 767px) {
    .site-branding .site-title a {
        font-size: 14px !important;
    }
}		</style>
</link></meta></head>
<body class="wp-singular page-template-default page page-id-102 wp-theme-onepress">
<div class="hfeed site" id="page">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div class="h-on-top no-transparent" id="header-section"> <header class="site-header header-contained is-sticky no-scroll no-t h-on-top" id="masthead" role="banner">
<div class="container">
<div class="site-branding">
<div class="site-brand-inner no-logo-img has-title has-desc"><p class="site-title"><a class="site-text-logo" href="https://spreadsheets-are-all-you-need.ai/" rel="home">Spreadsheets are all you need.ai</a></p><p class="site-description">Learn AI topics using familiar tools</p></div> </div>
<div class="header-right-wrapper">
<a href="#0" id="nav-toggle">Menu<span></span></a>
<nav class="main-navigation" id="site-navigation" role="navigation">
<ul class="onepress-menu">
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1429" id="menu-item-1429"><a href="https://maven.com/spreadsheets-are-all-you-need-ai/ai-for-everyone-master-ai-with-spreadsheets" target="_blank">Course</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1570" id="menu-item-1570"><a href="https://discord.gg/b66stSz87E">Discord</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1423" id="menu-item-1423"><a href="https://learningrateai.com/speaking/" target="_blank">Speaking</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1424" id="menu-item-1424"><a href="https://learningrateai.com/consulting/" target="_blank">Consulting</a></li>
</ul>
</nav>
</div>
</div>
</header>
</div> <div class="page-header">
<div class="container">
<h1 class="entry-title">Spreadsheets (in Browsers) are all you need: GPT2 in your browser</h1> </div>
</div>
<div class="site-content" id="content">
<div class="container no-sidebar" id="content-inside">
<div class="content-area" id="primary">
<main class="site-main" id="main" role="main">
<article class="post-102 page type-page status-publish hentry" id="post-102">
<header class="entry-header">
</header>
<div class="entry-content">
<script src="https://www.unpkg.com/ace-builds@latest/src-noconflict/ace.js"></script>
<script src="https://www.unpkg.com/ace-builds@latest/src-noconflict/ext-language_tools.js"></script>
<template id="saayn-sheet-template">
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
    }
    .spreadsheet-container {
        width: 100%;
        height: 400px;
        overflow: auto;
        border: 1px solid #ccc;
        position: relative;
    }      
    .spreadsheet {
        position: relative;
    }
    .cell, .header {
        position: absolute;
        width: 100px;
        height: 25px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #fff;
    }
    .header {
        background-color: #f0f0f0;
        font-weight: bold;
    }
    .corner-header {
        position: sticky;
        top: 0;
        left: 0;
        width: 100px;
        height: 25px;
        background-color: #d0d0d0;
        z-index: 3;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }
    .row-header {
        left: 0;
        width: 100px;
        z-index: 2;
    }
    .col-header {
        top: 0;
        z-index: 1;
    }
    .cell input {
        width: 100%;
        height: 100%;
        border: none;
        padding: 0 5px;
        box-sizing: border-box;
    }
    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
    }
    .namebox-container {
        margin-bottom: 10px;
    }
    .navigation-container {
      margin-left: 10px;
      font-size: 1.25em;        
    }
    
    .formula-box {
        padding: 5px;
        width: 60%;
        margin: 10px 10px 10px 10px;
    }
    .namebox-button {
        padding: 5px 10px;
        cursor: pointer;
    }
    .formula-box, .namebox-button {
      font-size: 1.25em;
      line-height: 1.5em;
      
    }
    .namebox-input {
        width: 100px;
    }
    .namebox-input, .namebox-button {
       font-size: 0.75em;
       line-height: 1.25em;
       margin: 5px 5px 5px 5px;
     }
    .namebox-input, .namebox-button {
      display: none;
    }
    
  </style>
<div class="spreadsheet-widget">
<div class="navigation-container">
<span> Formula: </span><input class="formula-box" type="text"/>
<br/>
<input class="namebox-input" placeholder="R1C1 address" type="text"/>
<button class="namebox-button">Go to R1C1 address</button>
</div>
<div class="spreadsheet-container">
<div class="spreadsheet">
<div class="corner-header"></div>
</div>
<canvas class="overlay"></canvas>
</div>
<div>
</div></div></template>
<script>      
// Create an indirect reference to global eval.
// This will force eval to be run in the global scope. 
// We use this so code blocks and sheet formulas operate in 
// global scope and share names with each other
const globalEval = eval;

// Class for <saayn-sheet> element. It's job is to use virtual 
// scrolling to display the 2D table output resulting from 
// executing a predefined formula.
class SaaynSheet extends HTMLElement {
      
    constructor() {
      super();
    
      // Create shadow root
      this.attachShadow({ mode: 'open' });
    
      // Create the template content
      const template = document.getElementById('saayn-sheet-template');
          
      // Add template content to shadow DOM
      this.shadowRoot.appendChild(template.content.cloneNode(true));
    }

    connectedCallback() {
      this.totalRows = 1000000;
      this.totalCols = 3000;
      this.name = this.getAttribute("id");

      this.cells = []
      
      this.navigationContainer = this.shadowRoot.querySelector(".navigation-container");
      this.nameBoxInput = this.shadowRoot.querySelector(".namebox-input");
      this.nameBoxButton = this.shadowRoot.querySelector(".namebox-button");
      this.formulaBox = this.shadowRoot.querySelector(".formula-box");
      if(this.getAttribute("formula")) {
        this.formulaBox.value = this.getAttribute("formula");
      }
      if(this.getAttribute("row_labels")) {
        this.rowLabelFormula = this.getAttribute("row_labels");
      }
      if(this.getAttribute("column_labels")) {
        this.columnLabelFormula = this.getAttribute("column_labels");
      }

      
      this.cornerHeader = this.shadowRoot.querySelector(".corner-header");
      this.cornerHeader.addEventListener("click", () => this.toggleNameBoxDisplay());
              
      this.sheetContainer = this.shadowRoot.querySelector(".spreadsheet-container");
    
    
      this.sheetDiv = this.shadowRoot.querySelector(".spreadsheet");
      const cornerHeader = this.shadowRoot.querySelector(".corner-header");
      const canvasElement = this.shadowRoot.querySelector("canvas");

      
      this.scrollContainer = this.sheetContainer;
      this.cellWidth = 100;
      this.cellHeight = 25;
      this.headerWidth = 100;
      this.visibleRows = 0;
      this.visibleCols = 0;
      this.firstVisibleRow = 0;
      this.firstVisibleCol = 0;
      
      this.cellElements = [];
      this.rowHeaderElements = [];
      this.colHeaderElements = [];
      this.overlay = this.sheetContainer.querySelector('.overlay');
      this.ctx = this.overlay.getContext('2d');
      
      this.initializeSpreadsheet();
      
      setTimeout(() => {
          this.updateVisibleCells();
          this.positionCells();
          this.drawGridLines();
      }, 100);      
      
    }

    toggleNameBoxDisplay() {
      if(this.nameBoxInput.checkVisibility()) {
        this.nameBoxInput.style.display = "none";
        this.nameBoxButton.style.display = "none";
      } else {
        this.nameBoxInput.style.display = "inline";
        this.nameBoxButton.style.display = "inline";
        
      }
      
    }

    disconnectedCallback() {
      // TODO. Properly cleanup.
    }

    initializeSpreadsheet() {
        this.sheetDiv.style.width = `${this.headerWidth + (this.totalCols * this.cellWidth)}px`;
        this.sheetDiv.style.height = `${this.cellHeight + (this.totalRows * this.cellHeight)}px`;
        
        this.updateVisibleCells();
        this.createReusableCells();
        this.createHeaders();
        this.positionCells();
        this.positionHeaders();

        this.scrollContainer.addEventListener('scroll', () => this.handleScroll());
        window.addEventListener('resize', () => this.handleResize());

        this.drawGridLines();
        
        // Bind listeners
        this.scrollContainer.addEventListener('input', this.inputElementInputListener.bind(this));
        this.scrollContainer.addEventListener('blur', this.inputElementBlurListener.bind(this), true);
        this.scrollContainer.addEventListener('keydown', this.keyDownListener.bind(this));
        this.scrollContainer.addEventListener('focus', this.inputElementFocusListener.bind(this), true);
        this.nameBoxButton.addEventListener('click', this.nameBoxButtonClickListener.bind(this));
        this.nameBoxInput.addEventListener('keypress', this.nameBoxInputKeyPressListener.bind(this));

    }

    updateVisibleCells() {
        const rect = this.scrollContainer.getBoundingClientRect();
        this.visibleRows = Math.ceil(rect.height / this.cellHeight) - 1;
        this.visibleCols = Math.ceil(rect.width / this.cellWidth) - 1;
    }

    createReusableCells() {
        const totalCells = (this.visibleRows + 1) * (this.visibleCols + 1);
        for (let i = 0; i < totalCells; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            const input = document.createElement('input');
            cell.appendChild(input);
            this.sheetDiv.appendChild(cell);
            this.cellElements.push(cell);
        }
    }

    createHeaders() {
        // Create row headers
        for (let i = 0; i < this.visibleRows + 1; i++) {
            const header = document.createElement('div');
            header.className = 'header row-header';
            this.sheetDiv.appendChild(header);
            this.rowHeaderElements.push(header);
        }

        // Create column headers
        for (let i = 0; i < this.visibleCols + 1; i++) {
            const header = document.createElement('div');
            header.className = 'header col-header';
            this.sheetDiv.appendChild(header);
            this.colHeaderElements.push(header);
        }
    }

    positionCells() {
        let index = 0;
        for (let row = 0; row < this.visibleRows + 1; row++) {
            for (let col = 0; col < this.visibleCols + 1; col++) {
                const cell = this.cellElements[index];
                const actualRow = this.firstVisibleRow + row;
                const actualCol = this.firstVisibleCol + col;
                cell.style.top = `${this.cellHeight + (actualRow * this.cellHeight)}px`;
                cell.style.left = `${this.headerWidth + (actualCol * this.cellWidth)}px`;
                cell.firstChild.value = this.getCellValue(actualRow, actualCol);
                index++;
            }
        }
    }

    positionHeaders() {
        // Position row headers
        for (let i = 0; i < this.rowHeaderElements.length; i++) {
            const actualRow = this.firstVisibleRow + i;
            this.rowHeaderElements[i].style.top = `${this.cellHeight + (actualRow * this.cellHeight)}px`;
            if(this.rowLabels && this.rowLabels[actualRow]) {
              this.rowHeaderElements[i].textContent = (actualRow + 1) + ": "+ this.rowLabels[actualRow];
            } else {
              this.rowHeaderElements[i].textContent = actualRow + 1;
            }
        }

        // Position column headers
        for (let i = 0; i < this.colHeaderElements.length; i++) {
            const actualCol = this.firstVisibleCol + i;
            this.colHeaderElements[i].style.left = `${this.headerWidth + (actualCol * this.cellWidth)}px`;
            if(this.columnLabels && this.columnLabels[actualCol]) {
              this.colHeaderElements[i].textContent = (actualCol + 1) + ": "+ this.columnLabels[actualCol];
            } else {
              this.colHeaderElements[i].textContent = actualCol + 1;
            }
        }
    }

    handleScroll() {
        const newFirstVisibleRow = Math.floor((this.scrollContainer.scrollTop - this.cellHeight) / this.cellHeight);
        const newFirstVisibleCol = Math.floor((this.scrollContainer.scrollLeft - this.headerWidth) / this.cellWidth);

        if (newFirstVisibleRow !== this.firstVisibleRow || newFirstVisibleCol !== this.firstVisibleCol) {
            this.firstVisibleRow = Math.max(0, newFirstVisibleRow);
            this.firstVisibleCol = Math.max(0, newFirstVisibleCol);
            this.positionCells();
            this.positionHeaders();
        }

        this.drawGridLines();
    }

    handleResize() {
        this.updateVisibleCells();
        this.createReusableCells();
        this.createHeaders();
        this.positionCells();
        this.positionHeaders();
        this.drawGridLines();
    }

    drawGridLines() {
        this.overlay.width = this.scrollContainer.clientWidth;
        this.overlay.height = this.scrollContainer.clientHeight;
        this.ctx.strokeStyle = '#ccc';
        this.ctx.lineWidth = 1;

        const startCol = Math.floor((this.scrollContainer.scrollLeft - this.headerWidth) / this.cellWidth);
        const startRow = Math.floor((this.scrollContainer.scrollTop - this.cellHeight) / this.cellHeight);
        const endCol = startCol + this.visibleCols + 1;
        const endRow = startRow + this.visibleRows + 1;

        for (let col = startCol; col <= endCol; col++) {
            const x = this.headerWidth + (col * this.cellWidth) - this.scrollContainer.scrollLeft;
            this.ctx.beginPath();
            this.ctx.moveTo(x, 0);
            this.ctx.lineTo(x, this.overlay.height);
            this.ctx.stroke();
        }

        for (let row = startRow; row <= endRow; row++) {
            const y = this.cellHeight + (row * this.cellHeight) - this.scrollContainer.scrollTop;
            this.ctx.beginPath();
            this.ctx.moveTo(0, y);
            this.ctx.lineTo(this.overlay.width, y);
            this.ctx.stroke();
        }
    }

    scrollToCell(row, col) {
        const targetScrollTop = row * this.cellHeight;
        const targetScrollLeft = col * this.cellWidth;
        
        this.scrollContainer.scrollTo({
            top: targetScrollTop,
            left: targetScrollLeft,
            behavior: 'smooth'
        });
    }

    getCellValue(row, col) {
      // Check if row is defined
      if (this.cells[row] === undefined) {
        return "";
      }
            
      // Check if the cell value is not undefined or null
      const cellValue = this.cells[row][col];
      if (cellValue !== undefined && cellValue !== null) {
        return cellValue;
      } else {
        return "";
      }
    }        
    setCellValue(row, col, input) {

      // Attempt to cast input as Number so that numbers are stored
      // as numbers instead of text.
      const numericInput = Number(input);
      if (isNaN(numericInput)) {
        // NaN ==> Store as string. 
        this.cells[row][col] = input;
      } else {
        // Valid number ==> Store as number.
        this.cells[row][col] = numericInput;
      }
    }

    redrawVisibleCells() {
        this.cellElements.forEach(cellElement => {
            const row = Math.floor((parseInt(cellElement.style.top) - this.cellHeight) / this.cellHeight);
            const col = Math.floor((parseInt(cellElement.style.left) - this.headerWidth) / this.cellWidth);
            cellElement.firstChild.value = this.getCellValue(row, col);
        });
    }
    
    parseCellReference(reference) {
        const match = reference.match(/R(\d+)C(\d+)/);
        if (match) {
            return {
                row: parseInt(match[1]) - 1,
                col: parseInt(match[2]) - 1
            };
        }
        throw new Error('Invalid cell reference');
    }
    
    prefillCells(cellValues) {
      this.cells = cellValues;
      this.redrawVisibleCells();
    }    
    
    inputElementFocusListener(event) {
      if (event.target.tagName === 'INPUT') {
        const cell = event.target.parentElement;
        const row = Math.floor((parseInt(cell.style.top) - this.cellHeight) / this.cellHeight);
        const col = Math.floor((parseInt(cell.style.left) - this.headerWidth) / this.cellWidth);
      }
    }
    
    inputElementInputListener(event) {
      if (event.target.tagName === 'INPUT') {
          const cell = event.target.parentElement;
          const row = Math.floor((parseInt(cell.style.top) - this.cellHeight) / this.cellHeight);
          const col = Math.floor((parseInt(cell.style.left) - this.headerWidth) / this.cellWidth);
          this.setCellValue(row, col, event.target.value);
      }
    }
    
    inputElementBlurListener(event) {
      if (event.target.tagName === 'INPUT') {
          const cell = event.target.parentElement;
          const row = Math.floor((parseInt(cell.style.top) - this.cellHeight) / this.cellHeight);
          const col = Math.floor((parseInt(cell.style.left) - this.headerWidth) / this.cellWidth);
      }      
    }
    
    keyDownListener(event) {
      if (event.target.tagName === 'INPUT') {
          if (event.key === '=' && event.target.selectionStart === 0) {
              // Allow '=' only at the start of the input
              event.preventDefault();
              event.target.value = '=' + event.target.value;
              event.target.setSelectionRange(1, 1);
          } else if (event.key === 'Enter') {
              event.preventDefault();
              const cell = event.target.parentElement;
              const row = Math.floor((parseInt(cell.style.top) - this.cellHeight) / this.cellHeight);
              const col = Math.floor((parseInt(cell.style.left) - this.headerWidth) / this.cellWidth);
              // Move focus to the cell below
              const nextCell = this.cellElements.find(el => 
                  parseInt(el.style.top) === (row + 1) * this.cellHeight + this.cellHeight &&
                  parseInt(el.style.left) === col * this.cellWidth + this.headerWidth
              );
              if (nextCell) nextCell.firstChild.focus();
          }
      }
      
    }
    
    
    nameBoxButtonClickListener(event) {
        const reference = this.nameBoxInput.value.trim().toUpperCase();
        const cellPosition = this.parseCellReference(reference);
        if (cellPosition) {
            this.scrollToCell(cellPosition.row, cellPosition.col);
        } else {
            alert('Invalid cell reference. Please use R1C1 format.');
        }
    }

    nameBoxInputKeyPressListener(event) {
        if (event.key === 'Enter') {
            this.nameBoxButton.click();
        }
    }
        
    async saaynRunCell() {
      
      function replaceWithQuerySelector(input) {
          return input.replace(/\b(\w+)\[\]/g, (match, id) => {
              return `document.querySelector("#${id}")`;
          });
      }
      
      
      function getFirstRow(arr) {
        if(!arr || arr.length ==0){
          return [];
        }
        
        // assume the array is 1D if the first entry is not an array.
        // if the array is 1D just return the 1D array (i.e. [1, 2, 3, 4, ..])
        if(!Array.isArray(arr[0])) {
          return arr;
        }
        
        // is the array really a 1D array nested in another array?
        // e.g. [[1, 2, 3, 4, ...]]
        // if so, return the 1D array inside
        if(arr.length == 1 && Array.isArray(arr[0]) ){  
          return arr[0];
        }
        
        // is the array a 2D array? e.g. [[1, 2, 3, 4], [5, 6, 7, 8]]
        // in this case, return the first row
        return arr[0];
      }
      
      function getFirstColumn(arr) {
        if(!arr || arr.length ==0){
          return [];
        }
        
        // assume the array is 1D if the first entry is not an array.
        // if the array is 1D just return the 1D array (i.e. [1, 2, 3, 4, ..])
        if(!Array.isArray(arr[0])) {
          return arr;
        }
        
        // is the array really a 1D array nested in another array?
        // e.g. [[1, 2, 3, 4, ...]]
        // if so, return the 1D array inside
        if(arr.length == 1 && Array.isArray(arr[0]) ){  
          return arr[0];
        }
        
        // is the array a 2D array? e.g. [[1, 2, 3, 4], [5, 6, 7, 8]]
        // in this case, return the first column
        return arr.map(row => row[0]);                
      }
      
                  
      const code = replaceWithQuerySelector(this.formulaBox.value);
      const result = await globalEval(code);
      
      // Evaluate any labels
      let wereHeadersAltered = false;
      if(this.rowLabelFormula) {
        const rowLabelCode = replaceWithQuerySelector(this.rowLabelFormula);
        const rowLabelResult = await globalEval(rowLabelCode);
        this.rowLabels = getFirstRow(rowLabelResult);
        wereHeadersAltered = true;
      }
      if(this.columnLabelFormula) {
        const columnLabelCode = replaceWithQuerySelector(this.columnLabelFormula);
        const columnLabelResult = await globalEval(columnLabelCode);
        this.columnLabels = getFirstColumn(columnLabelResult);
        wereHeadersAltered = true;
      }
      if(wereHeadersAltered) {
        this.positionHeaders();
      }
      
      if(result) {
        this.prefillCells(result);
      }
    }
    
}
customElements.define('saayn-sheet', SaaynSheet);
</script>
<script>

// Helper Functions
window.Saayn = {};

// Used to obtain the raw underlying matrix from a sheet/table element or formula
window.Saayn.get_matrix_from_table = async function(obj) {
  let found_obj = obj;

  if(obj instanceof Promise) {
     found_obj = await obj;
  }

  if(found_obj.cells) {
    return found_obj.cells;
  }

  return found_obj;
}

</script>
<template id="saayn-cell-template">
<style>
    .saayn-cell {
      display: flex;
      border: 1px solid #ccc;
      margin: 10px 0;
      min-height: 60px;
    }

    .execution-area {
      flex: 0 0 64px;
      background: #f5f5f5;
      padding: 12px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-right: 1px solid #ccc;
    }

    .content-area {
      flex: 1;
      padding: 12px;
      display: flex;
      flex-direction: column;
      min-width: 0; /* Prevent flex item from overflowing. Chrome crashes (!!) without this due to layout thrashing. */
    }

    .play-button {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 0;
      position: relative;
      margin: 4px 0;
    }

    .play-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 8px 0 8px 12px;
      border-color: transparent transparent transparent #666;
      transition: border-color 0.2s;
    }

    .play-button:hover::before {
      border-color: transparent transparent transparent #333;
    }

    .play-button.running::before {
      animation: spin 1s linear infinite;
      border-width: 2px;
      border-style: solid;
      border-color: #666 #666 #666 transparent;
      border-radius: 50%;
      width: 16px;
      height: 16px;
    }

    @keyframes spin {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .execution-count {
      margin-top: 4px;
      color: #666;
    }

    .cell-content {
      min-height: 24px;
      padding: 4px 0;
      flex: 1;
    }

    .log-output {
      font-family: monospace;
      white-space: pre-wrap;
      color: #333;
      margin: 8px 0 0 0;
      padding: 4px 0;
      border-top: 1px solid #eee;
      min-height: 20px;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
    }

    .accordion-button {
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }

    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
  
    .run-to-cell {
      margin-top: 60px;
      font-size: 2em;
    }
  
    #title {
      padding-bottom: 0px;
      margin-bottom: 3px;
    
    }
  
    #cell-type {
      margin-top: 0px;
      padding-top: 0px;
      margin-bottom: 30px;
      color: grey;
    }
  
  </style>
<div class="saayn-cell">
<div class="execution-area">
<button aria-label="Run cell" class="play-button"></button>
<div class="execution-count">Run [<span>0</span>]</div>
<button class="run-to-cell">⍗</button>
</div>
<div class="content-area">
<h1 id="title"></h1>
<h3 id="cell-type"></h3>
<slot class="cell-content" id="slot-placeholder"></slot>
<div class="log-output"></div>
</div>
</div>
</template>
<script>  
  class SaaynCell extends HTMLElement {
    // Static counter shared across all instances
    static executionCount = 0;
  
    // Keep track of each cell's last execution number
    #lastExecutionNumber = '*';
  
    constructor() {
      super();
    
      // Create shadow root
      this.attachShadow({ mode: 'open' });
    
      // Create the template content
      const template = document.getElementById('saayn-cell-template');
    
      // Add template content to shadow DOM
      this.shadowRoot.appendChild(template.content.cloneNode(true));
    
      this.count = 0;
    }

    connectedCallback() {
      // Select elements from shadow DOM
      this.playButton = this.shadowRoot.querySelector('.play-button');
      this.executionCount = this.shadowRoot.querySelector('.execution-count span');
      this.logOutput = this.shadowRoot.querySelector('.log-output');
      this.titleObject = this.shadowRoot.querySelector("#title");
      this.cellElement = this.shadowRoot.querySelector(".saayn-cell");
      this.runToCellButton = this.shadowRoot.querySelector(".run-to-cell");
      this.cellType = this.shadowRoot.querySelector("#cell-type");
      
      // We call this "cellSlot" to avoid naming conflict with HTMLElement's predefined this.slot field
      this.cellSlot = this.shadowRoot.querySelector('slot');
    
      if (this.getAttribute("id")) {
        this.titleObject.textContent = this.getAttribute("id");
      }
      
      this.cellSlot.addEventListener('slotchange', () => {this.slotReady()});
      this.runToCellButton.addEventListener('click', () => {this.runToCell()})
        
      // Setup event listeners
      this.setupEventListeners();
    }
  
    slotReady() {
      // Slot is populated. Grab the ID of any child as the title of this cell. This is 
      // a bit of syntactic sugar so you don't need to specify both an ID and title separately.
      for(let i = 0; i<this.children.length; i++) {
        let childName = this.children[i].tagName;
        if(childName.indexOf("SAAYN-") == 0) {
          this.cellType.innerText = "(" + childName.toLowerCase().replace("saayn-", "") + ")";
          let childID = this.children[i].getAttribute("id");
          if(childID) {
            this.titleObject.textContent = childID;
          }
        }
      }
    }
    
    setupEventListeners() {
      this.playButton.addEventListener('click', () => {
        this.runCell();
      });
    }
  
    async runToCell() {
      // Mark this cell as "running" (even though it isn't running yet) because this is where 
      // the user triggered the action and we need to provide feedback for the click.
      this.playButton.classList.add('running');
      const listenHandle = document.addEventListener("SaaynCellRunError", () => {this.handleCellRunErrorEvent()});
      
      // Run all cells up to an including this cell.
      var cells = document.querySelectorAll("saayn-cell");
      let status = false;
      for(var i = 0; i < cells.length; i++){
        status = await cells[i].runCell();
        if(!status) {
          break;
        }
        if(cells[i] == this) {
          break;
        }
      }
      
      // Cleanup
      document.removeEventListener("SaaynCellRunError", listenHandle);
      
    }
    
    
    dispatchCellRunErrorEvent() {
      const event = new Event("SaaynCellRunError");
      document.dispatchEvent(event);
    }

    handleCellRunErrorEvent() {
      this.playButton.classList.remove('running');
    }
    
  
    async runCell() {
      // Increment the shared counter
      SaaynCell.executionCount++;
      this.#lastExecutionNumber = SaaynCell.executionCount;
      let returnStatus = true;
    
      // Update the display
      this.executionCount.textContent = this.#lastExecutionNumber;
      this.playButton.classList.add('running');
    
      var runnableElement = null;
      Array.from(this.children).forEach(function (element) {
        if(element.saaynRunCell) {
          runnableElement = element;
        }
      });
      if(runnableElement) {

        try {
          const before = new Date();
          const result = await runnableElement.saaynRunCell();
          const after = new Date();
          const duration = after.getTime() - before.getTime();
          if(result) {
            let lines = String(result).split('\n');
            if(lines.length == 1) {
              this.logOutput.innerHTML += `Execution [${this.#lastExecutionNumber}] (${duration}ms) returned: ${result}\n`;
            } else {
              this.logOutput.innerHTML += `Execution [${this.#lastExecutionNumber}] (${duration}ms) returned: ${lines[0]} ...  <span onclick="SaaynCell.staticAccordionClickListener(event)" class="accordion-button">Expand</span>\n
    <div class="accordion-content">
      ${result}
    </div>`;
            
            }
          } else {
            this.logOutput.innerHTML += `Execution [${this.#lastExecutionNumber}] (${duration}ms) completed\n`;
          }
        } catch (error) {
          this.logOutput.innerHTML += `Execution [${this.#lastExecutionNumber}] error: ${error}\n`;
          
          // let other cells know processing has stopped (in cases where cells call other cells or 
          // when using the run to cell button)
          this.dispatchCellRunErrorEvent();
          returnStatus = false;
        }
      } else {
        this.logOutput.textContent += `Execution [${this.#lastExecutionNumber}] No Runnable Method\n`;
      }
    
      this.playButton.classList.remove('running');    
      if(returnStatus) {
        this.cellElement.style.borderColor = "#ccc";
      } else {
        this.cellElement.style.borderColor = "red";
      }
    
      return returnStatus;
    }
    
    
    static staticAccordionClickListener(event) {
      const target = event.target;
      const content = target.nextElementSibling;

          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            target.innerHTML = "Expand";
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
            target.innerHTML = "Close";
          }
    }
    
  }

  customElements.define('saayn-cell', SaaynCell);
</script>
<template id="saayn-code-template">
<style>
    .saayn-code-textarea {
      width: 100%;
      height: 200px;
      border: 2px solid #7B7B7B;
    }
  </style>
<div>
<div class="saayn-code-textarea" id="editor"></div>
<slot></slot>
</div>
</template>
<script>
class SaaynCode extends HTMLElement {
      
  constructor() {
      super();

      // Create shadow root
      this.attachShadow({ mode: 'open' });

      // Create the template content
      const template = document.getElementById('saayn-code-template');

    this.shadowRoot.appendChild(template.content.cloneNode(true));
  }

  connectedCallback() {

    // Configure Ace text editor
    this.codeTextarea = this.shadowRoot.querySelector(".saayn-code-textarea");
    this.codeEditor = ace.edit(this.codeTextarea);
    this.codeEditor.session.setMode("ace/mode/javascript"); 
    this.codeEditor.setTheme("ace/theme/chrome");
    this.codeEditor.setOptions({
        enableBasicAutocompletion: true,
        enableLiveAutocompletion: true
    });      
    
    // Needed when using Ace in a web component.
    this.codeEditor.renderer.attachToShadowRoot();

    
    // We use cellSlot as the field name to avoid naming conflict 
    // with HTMLElement's predefined this.slot field
    this.cellSlot = this.shadowRoot.querySelector('slot');        
    this.cellSlot.addEventListener('slotchange', () => {this.slotReady()});


  }
  
  slotReady() {
    // Slot is ready. Look for a <script> child element. This will contain the
    // code we are supposed to execute in this cell.
    for(let i = 0; i<this.children.length; i++) {
      let childElement = this.children[i];
      if(childElement.tagName != "SCRIPT") {
        continue;
      }
      
      if(childElement.getAttribute("type") == "text/javascript") {
        this.isNotPlainText = true; // see comment in saaynRunCell()
      } 
      
      // Without the -1, the inserted text will be selected in Ace.
      this.codeEditor.setValue(childElement.innerText, -1);
      
    }  
  }  
  
  async saaynRunCell() {
    if(this.isNotPlainText) {
      // Don't execute code from a node that has type="text/javascript"
      // because it has already been executed by the browser.
      // You might think this should be flagged as an error but we leave it as an option
      // for debugging. When debugging code in blocks it can be helpful to let a script tag
      // be parsed by the browser so you can use the browser's built in debugger.
      return "'Already run by browser'";
    }
    
    const result = await globalEval(this.codeEditor.getValue());
    return result;
  }
}

customElements.define('saayn-code', SaaynCode);
</script>
<script>
class CsvUploader extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    this.shadowRoot.innerHTML = `
      <style>
        .uploader {
          border: 2px dashed #ccc;
          padding: 20px;
          text-align: center;
          transition: background-color 0.3s;
        }
        .uploader.dragover {
          background-color: #e0e0e0;
        }
        .uploader label {
          cursor: pointer;
          color: #007bff;
        }
        .progress {
          margin-top: 10px;
        }
        .ready {
          color: green;
          font-weight: bold;
        }
        #statusMessage:not(.ready) {
          color: red;
          font-weight: bold;
        }
        
      </style>
      <div class="uploader" id="dropZone">
        <p id="statusMessage"></p>
        <input type="file" id="fileInput" accept=".csv" multiple />
        <label for="fileInput" id="fileInputLabel"> (or drag and drop here)</label>
        <div class="progress">

          <p id="filesLoaded">Files loaded: 0</p>        
          <p id="totalSize">Total size: 0 GB</p>
        </div>
        <button class="clear-btn" id="clearBtn">Clear All</button>
      </div>
    `;
    this.expectedFiles = [];
    this.loadedFiles = new Set();
  }

  static get observedAttributes() {
    return ['expected-files'];
  }

  attributeChangedCallback(name, oldValue, newValue) {
    if (name === 'expected-files') {
      this.expectedFiles = newValue.split(',').map(file => file.trim());
    }
  }

  connectedCallback() {
    this.shadowRoot.querySelector('#fileInput').addEventListener('change', this.handleFileSelect.bind(this));
    const dropZone = this.shadowRoot.querySelector('#dropZone');
    dropZone.addEventListener('dragover', this.handleDragOver.bind(this));
    dropZone.addEventListener('dragleave', this.handleDragLeave.bind(this));
    dropZone.addEventListener('drop', this.handleDrop.bind(this));
    this.shadowRoot.querySelector("#clearBtn").addEventListener('click', this.clearAll.bind(this));
    this.initDatabase().then(() => {
      this.checkAllFilesLoaded();
    });
  }

  async clearAll() {
    const transaction = this.db.transaction(['csvFiles'], 'readwrite');
    const objectStore = transaction.objectStore('csvFiles');
    const clearRequest = objectStore.clear();

    clearRequest.onsuccess = () => {
      console.log('All files cleared from IndexedDB.');
      this.loadedFiles.clear();
      this.updateStatusMessage(this.expectedFiles);
    };

    clearRequest.onerror = (event) => {
      console.error('Error clearing IndexedDB:', event.target.errorCode);
    };
  }


  handleDragOver(event) {
    event.preventDefault();
    this.shadowRoot.querySelector('#dropZone').classList.add('dragover');
  }

  handleDragLeave(event) {
    this.shadowRoot.querySelector('#dropZone').classList.remove('dragover');
  }

  handleDrop(event) {
    event.preventDefault();
    this.shadowRoot.querySelector('#dropZone').classList.remove('dragover');
    const files = event.dataTransfer.files;
    this.processFiles(files);
  }

  handleFileSelect(event) {
    const files = event.target.files;
    this.processFiles(files);
  }

  processFiles(files) {
    const totalFiles = files.length;
    let processedFiles = 0;

    Array.from(files).forEach(file => {
      if (file.type === 'text/csv' && !this.loadedFiles.has(file.name)) {
        const reader = new FileReader();
        reader.onload = () => {
          this.storeCSV(file.name, reader.result).then(() => {
            this.loadedFiles.add(file.name);
            processedFiles++;
            this.updateProgress();
            if (processedFiles === totalFiles) {
              console.log('All files processed.');
              this.checkAllFilesLoaded();
            }
          });
        };
        reader.readAsText(file);
      } else {
        console.warn(`Skipped file: ${file.name} (already loaded or not CSV).`);
      }
    });
  }


  async initDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open('CSVDatabase', 1);

      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        if (!db.objectStoreNames.contains('csvFiles')) {
          db.createObjectStore('csvFiles', { keyPath: 'id' });
        }
      };

      request.onsuccess = (event) => {
        this.db = event.target.result;
        resolve();
      };

      request.onerror = (event) => {
        console.error('Database error:', event.target.errorCode);
        reject(event.target.errorCode);
      };
    });
  }

  async storeCSV(id, csvContent) {
    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction(['csvFiles'], 'readwrite');
      const objectStore = transaction.objectStore('csvFiles');
      const blob = new Blob([csvContent], { type: 'text/csv' });

      objectStore.put({ id, file: blob });

      transaction.oncomplete = () => {
        console.log(`CSV file '${id}' stored successfully.`);
        resolve();
      };

      transaction.onerror = (event) => {
        console.error('Transaction error:', event.target.error);
        reject(event.target.error);
      };
    });
  }

  async updateProgress() {
    const transaction = this.db.transaction(['csvFiles'], 'readonly');
    const objectStore = transaction.objectStore('csvFiles');
    const getAllRequest = objectStore.getAll();

    getAllRequest.onsuccess = (event) => {
      const records = event.target.result;
      const fileCount = records.length;
      let totalSize = 0;

      records.forEach(record => {
        totalSize += record.file.size;
      });

      this.shadowRoot.querySelector('#filesLoaded').textContent = `Files loaded: ${fileCount}`;
      
      // Divide by 1000**2 and not 1024**2 because the former matches the values used by Chrome inspector when displaying indexDB storage
      this.shadowRoot.querySelector('#totalSize').textContent = `Total size: ${(totalSize / (1000 ** 2)).toFixed(2)} MB`;
      

    };

    getAllRequest.onerror = (event) => {
      console.error('Error retrieving records:', event.target.error);
    };
  }

  async updateStatusMessage(missingFiles) {
    const statusMessage = this.shadowRoot.querySelector('#statusMessage');
    if (missingFiles.length === 0) {
      statusMessage.textContent = 'Ready. All model parameters loaded.';
      statusMessage.classList.add('ready');

      // Hide the upload button
      this.shadowRoot.querySelector('#fileInput').style.display="none";
      this.shadowRoot.querySelector('#fileInputLabel').style.display="none";
      
    } else {
      statusMessage.textContent = `Please load model parameters.`;
      this.shadowRoot.querySelector('#fileInput').style.display="inline";
      this.shadowRoot.querySelector('#fileInputLabel').style.display="inline";
      console.log(`Missing files: ${missingFiles.join(', ')}`)
      statusMessage.classList.remove('ready');
    }
    await this.updateProgress();
  }

  async checkAllFilesLoaded() {
    const transaction = this.db.transaction(['csvFiles'], 'readonly');
    const objectStore = transaction.objectStore('csvFiles');
    const missingFiles = [];

    for (const fileName of this.expectedFiles) {
      const request = objectStore.get(fileName);
      request.onsuccess = async (event) => {
        if (!event.target.result) {
          missingFiles.push(fileName);
        }
        await this.updateStatusMessage(missingFiles);
      };
      request.onerror = (event) => {
        console.error(`Error checking file '${fileName}':`, event.target.error);
      };
    }
  }
}

customElements.define('csv-uploader', CsvUploader);
</script>
<script>
  
// Code for Running a bunch of cells at a time and scrolling them into 
// focus as they run.  
let currentAnimationFrameId = null;

function scrollToElement(targetElement, duration = 1000) {
  // Cancel any ongoing scroll animation
  if (currentAnimationFrameId) {
    cancelAnimationFrame(currentAnimationFrameId);
    currentAnimationFrameId = null;
  }

  return new Promise((resolve) => {
    const startPosition = window.pageYOffset;
    let targetPosition = targetElement.getBoundingClientRect().top + startPosition;
    
    // Adjust target to leave space for the global play controls
    const button = document.getElementById('globalPlayControls');
    const siteHeader = document.querySelector("header");
    const offsetTop = button.offsetTop + siteHeader.getBoundingClientRect().bottom;;
    if (window.scrollY > offsetTop) {
      targetPosition -= offsetTop + 10;
    }
    
    const startTime = performance.now();

    function animateScroll(currentTime) {
      const elapsedTime = currentTime - startTime;
      const progress = Math.min(elapsedTime / duration, 1);
      const ease = progress < 0.5
        ? 2 * progress * progress
        : -1 + (4 - 2 * progress) * progress;

      window.scrollTo(0, startPosition + (targetPosition - startPosition) * ease);

      if (elapsedTime < duration) {
        currentAnimationFrameId = requestAnimationFrame(animateScroll);
      } else {
        currentAnimationFrameId = null;
        resolve();
      }
    }

    currentAnimationFrameId = requestAnimationFrame(animateScroll);
  });
}

function sleep(milliseconds) {
  return new Promise(resolve => setTimeout(resolve, milliseconds));
}

// valid values: reset, run, pause
window.runAllCellsState = "reset"; 

async function run_all_cells_loop() {
  var cells = document.querySelectorAll("saayn-cell");
  let status = false;
  const before = new Date();
  let i = 0;
  while(i < cells.length){
    await sleep(500);    
    if(window.runAllCellsState == "pause") {
      continue;
    }
    if(window.runAllCellsState == "reset") {
      break;
    }
    if(window.followRunningCell) {
      await scrollToElement(cells[i], 300);
    }
    status = await cells[i].runCell();
    if(!status) {
      break;
    } 
    i++;
  }
  const after = new Date();
  const duration = after.getTime()-before.getTime();
  run_all_cells_reset();
  console.log(`Total execution time ${duration}ms`);
}

async function run_all_cells() {
  const button = document.querySelector("#run_all_cells_button");
  if(window.runAllCellsState == "reset") {
    // Currently in Reset, in that case start running
    window.runAllCellsState = "run";
    button.innerHTML = "Pause";
    run_all_cells_loop();    
  } else if (window.runAllCellsState == "run") {
    // Currently in run state, in that case pause.
    window.runAllCellsState = "pause";    
    button.innerHTML = "Resume";
  } else if (window.runAllCellsState == "pause") {
    // Currently paused, in that case run
    window.runAllCellsState = "run";
    button.innerHTML = "Pause";    
  }
}

function run_all_cells_reset() {
  window.runAllCellsState = "reset";
  document.querySelector("#run_all_cells_button").innerHTML = "Run";
}
</script>
<style>
  .play-pause-button {
    position: relative; /* Initial position */
    /* Additional styling for the button */
    border: 1px solid blue;
    background-color: grey;
    padding:10px 10px 10px 10px;
    color: white;
    /*width: 50%; */
  }

  .play-pause-button.sticky {
    position: fixed;
    top: 5px; /* Distance from the top when sticky */
    z-index: 1000; /* Ensure it appears above other content */
  }
  
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('globalPlayControls');
    const buttonOffsetTop = button.offsetTop;
    const siteHeader = document.querySelector("header");

    window.addEventListener('scroll', function() {
      if (window.scrollY > buttonOffsetTop) {
        button.classList.add('sticky');

        const headerBottom = siteHeader.getBoundingClientRect().bottom;

        // clamp to zero in case negative
        const offset = Math.max(headerBottom, 0);


        button.style.top = offset + 'px';
      } else {
        button.classList.remove('sticky');
      }
    });
  });

  window.followRunningCell = true;
</script>
<style>
  body {
    font-family: system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    margin: 0 auto;
    padding: 20px;
  }
  .highlight {
    background: #f0f0f0;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
  }
  code {
    background: #eee;
    padding: 2px 4px;
    border-radius: 4px;
  }
  .warning {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
  }
  div.saayncontent p, div.saayncontent div {
    max-width: 800px;
  }
</style>
<div class="saayncontent">
<section>
<h2 id="what-is-this">What is This?</h2>
<p>Experience GPT2 (an early precursor to ChatGPT) running entirely in your browser. This project reimagines the "Spreadsheets-are-all-you-need" Excel implementation as an interactive web experience, making LLM architecture more accessible to a wider audience, especially web developers.</p>
</section>
<section>
<h2>See It In Action</h2>
<p>Watch how GPT2 works in your browser:</p>
<div class="highlight">
<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/j7zs4ZRI-To?si=ONIrg_r5W-eVUwBF" style="display: block; margin: 10px auto 10px auto;" title="YouTube video player" width="560"></iframe>
</div>
<p>Also checkout <a href="https://www.youtube.com/watch?v=cXKJJEzIGy4" target="_blank">four techniques for debugging Spreadsheets-are-all-you-need</a> and this <a href="https://www.youtube.com/watch?v=siGKUyTk9M0" target="_blank">one hour walk through</a>.
  </p></section>
<section>
<h2>Why This Matters</h2>
<p>The original "Spreadsheets-are-all-you-need" Excel project evolved into:</p>
<ul>
<li>A <a href="https://www.ai.engineer/worldsfair/2024/schedule/spreadsheets-are-all-you-need-decoding-the-decoder-llm-without-de-code" target="_blank">keynote track presentation</a> at a major AI conference</li>
<li>A <a href="https://maven.com/spreadsheets-are-all-you-need-ai/ai-for-everyone-master-ai-with-spreadsheets?utm_source=saaynwebapp&amp;utm_medium=web" target="_blank">highly rated online course</a> on LLMs</li>
<li>Core material in a <a href="https://business.wisc.edu/news/ai-entrepreneur-ishan-anand-demystifies-large-language-models-through-hands-on-learning/" target="_blank">university machine learning class </a></li>
</ul>
<p>This browser-based version takes the next step in accessibility. Just as the web's "View Source" feature democratized web development, this project aims to demystify AI by letting anyone peek under the hood of a real language model. No Python or even Excel required, just your browser. You don't even need a server since everything runs locally (i.e. "offline first").</p>
<p class="highlight"><strong>Want to dive deeper?</strong> Check out my <a href="https://maven.com/spreadsheets-are-all-you-need-ai/ai-for-everyone-master-ai-with-spreadsheets?utm_source=saaynwebapp&amp;utm_medium=web" target="_blank">highly rated AI course on Maven</a> to master the inner workings of language models. We use this tool plus <strong><u>Google Sheets</u></strong>, <strong><u>Excel</u></strong>, and <strong><u>Python notebooks</u></strong> to provide a gentle introduction to how AI and LLMs work. <br>
<a href="https://maven.com/spreadsheets-are-all-you-need-ai/ai-for-everyone-master-ai-with-spreadsheets?utm_source=saaynwebapp&amp;utm_medium=web" target="_blank">
<img alt="" class="wp-image-92" decoding="async" fetchpriority="high" height="1800" sizes="(max-width: 3200px) 100vw, 3200px" src="https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2.png" srcset="https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2.png 3200w, https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2-300x169.png 300w, https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2-1024x576.png 1024w, https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2-768x432.png 768w, https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2-1536x864.png 1536w, https://spreadsheets-are-all-you-need.ai/wp-content/uploads/2024/02/Single-Instructor-2-2048x1152.png 2048w" style="padding: 10px 10px 10px 10px; class=" width="3200"/>
</a>
<br/> It's perfect for <strong><u>web developers</u></strong>, <strong><u>technical product managers</u></strong>, and <strong><u>engineering managers</u></strong> who need to get up to speed on AI quickly.</br></p>
<h4>President's Day Sale! Get 20% off with coupon code <a href="https://maven.com/spreadsheets-are-all-you-need-ai/ai-for-everyone-master-ai-with-spreadsheets?promoCode=PRES20" target="_blank">PRES20</a> until Feb 18th!</h4>
</section>
<div class="highlight" id="mc_embed_shell">
<style type="text/css">
/* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
#mc_embed_signup form {display:block; position:relative; text-align:left; margin: 20px}
#mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
#mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
#mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
#mc_embed_signup input:focus {border-color:#333;}
#mc_embed_signup .button {clear:both; background-color: #111; border: 0 none; border-radius:4px; transition: all 0.23s ease-in-out 0s; color: #FFFFFF; cursor: pointer; display: inline-block; font-size:15px; font-weight: normal; height: 32px; line-height: 32px; margin: 0 5px 10px 0; padding: 0 22px; text-align: center; text-decoration: none; vertical-align: top; white-space: nowrap; width: fit-content; width: -moz-fit-content;}
#mc_embed_signup .button:hover {background-color:#222;}
#mc_embed_signup .small-meta {font-size: 11px;}
#mc_embed_signup .nowrap {white-space:nowrap;}

#mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding-bottom:3%; min-height:50px; display:grid;}
#mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
* html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
#mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
#mc_embed_signup .mc-field-group input {display:block; width:100%; padding:8px 0; text-indent:2%;}
#mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}
#mc_embed_signup .mc-address-fields-group {display:flex; flex-direction:row; justify-content:space-evenly; width:96%; gap:15px;}
#mc_embed_signup .mc-sms-phone-group {display:flex; flex-direction:row; justify-content:space-evenly; width:96%; gap:15px; padding-top:5px;}

#mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
#mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
#mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
#mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
#mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

#mc_embed_signup .indicates-required {text-align:right; font-size:11px; margin-right:4%;}
#mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
#mc_embed_signup .clear {clear:both;}
#mc_embed_signup .foot {display:grid; grid-template-columns: 3fr 1fr; width:96%; align-items: center;}
@media screen and (max-width:400px) {#mc_embed_signup .foot {display:grid; grid-template-columns: 1fr; width:100%; align-items: center;}}

@media screen and (max-width:400px) {#mc_embed_signup .referralBadge {width:50%;}}

#mc_embed_signup .brandingLogo {justify-self:right;}
@media screen and (max-width:400px) {#mc_embed_signup .brandingLogo {justify-self:left;}}

#mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
#mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
#mc_embed_signup .mc-field-group.input-group label {display:inline;}
#mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

#mc_embed_signup div#mce-responses {float:left; top:-1.4em; padding:0em .5em 0em .5em; overflow:hidden; width:90%; margin: 0 5%; clear: both;}
#mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
#mc_embed_signup #mce-error-response {display:none;}
#mc_embed_signup #mce-success-response {color:#529214; display:none;}
#mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}
#mc_embed_signup .helper_text {color: #8d8985; margin-top: 2px; display: inline-block; padding: 3px; background-color: rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size: 14px; font-weight: normal; z-index: 1;}

#mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
#mc_embed_signup #num-subscribers {font-size:1.1em;}
#mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

#mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:3px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
#mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}	
        #mc_embed_signup{false;clear:left; font:14px Helvetica,Arial,sans-serif; width: px;}
        /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
           We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div class="highlight" id="mc_embed_signup">
<form action="https://spreadsheets-are-all-you-need.us21.list-manage.com/subscribe/post?u=96d33fd949860389358a81747&amp;id=c84c7806a0&amp;f_id=007780e6f0" class="validate" id="mc-embedded-subscribe-form" method="post" name="mc-embedded-subscribe-form" novalidate="" target="_self">
<div id="mc_embed_signup_scroll"><h2>Subscribe to get the latest updates and AI tutorials!</h2>
<div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input class="required email" id="mce-EMAIL" name="EMAIL" required="" type="email" value=""/></div>
<div hidden=""><input name="tags" type="hidden" value="2992962"/></div>
<div class="clear" id="mce-responses">
<div class="response" id="mce-error-response" style="display: none;"></div>
<div class="response" id="mce-success-response" style="display: none;"></div>
</div><div aria-hidden="true" style="position: absolute; left: -5000px;"><input name="b_96d33fd949860389358a81747_c84c7806a0" tabindex="-1" type="text" value=""/></div><div class="clear"><input class="button" id="mc-embedded-subscribe" name="subscribe" type="submit" value="Subscribe"/></div>
</div>
</form>
</div>
</div>
<section>
<h2>How It Works</h2>
<p>The entire implementation uses web components ("cells") to perform GPT2's inference calculations right in your browser:</p>
<ul>
<li>The <code>sheet</code> components contain the mathematical formulas that power GPT2</li>
<li>The <code>code</code> components define the JavaScript functions that support these calculations</li>
</ul>
<p>This layered approach lets you explore the model at different levels of abstraction:</p>
<ol>
<li>Start with high-level <code>sheet</code> formulas to grasp the basic concepts</li>
<li>Dive into the <code>code</code> components to understand the detailed implementation</li>
</ol>
<p>Built with web components, the implementation is:</p>
<ul>
<li>Easy to edit and enhance with additional educational content</li>
<li>Compatible with learning management systems (LMS)</li>
<li>Prepared for future features like AI-powered copilots that provide learning assistance (hopefully coming soon)</li>
</ul>
</section>
<section>
<h2>Current Limitations</h2>
<div class="warning">
<ul>
<li>Developed and tested on desktop Chrome browser</li>
<li>Does not currently support mobile devices (including iPhone)</li>
</ul>
</div>
</section>
<section>
<h2>Getting Started</h2>
<p>To run GPT2 in your browser, you'll need to load the model parameters:</p>
<div class="highlight">
<ol>
<li>Download the <a href="https://github.com/ianand/spreadsheets-are-all-you-need/releases/tag/v0.8.0-parameters" target="_blank">gpt2-small-csv.zip</a> (~500MB) file to your computer.</li>
<li>Extract the ZIP file</li>
<li>Drag and drop all the extracted CSV files into the upload area below.</li>
</ol>
</div>
<p class="warning">The model weights (about 1.5GB) will be stored in your browser's local database. You won't need to reload them unless you clear your browser data.</p>
</section>
<csv-uploader expected-files="bpe_token_ids.csv,model_h0_attn_c_attn_b.csv,model_h0_attn_c_attn_w.csv,model_h0_attn_c_proj_b.csv,model_h0_attn_c_proj_w.csv,model_h0_ln_1_b.csv,model_h0_ln_1_g.csv,model_h0_ln_2_b.csv,model_h0_ln_2_g.csv,model_h0_mlp_c_fc_b.csv,model_h0_mlp_c_fc_w.csv,model_h0_mlp_c_proj_b.csv,model_h0_mlp_c_proj_w.csv,model_h10_attn_c_attn_b.csv,model_h10_attn_c_attn_w.csv,model_h10_attn_c_proj_b.csv,model_h10_attn_c_proj_w.csv,model_h10_ln_1_b.csv,model_h10_ln_1_g.csv,model_h10_ln_2_b.csv,model_h10_ln_2_g.csv,model_h10_mlp_c_fc_b.csv,model_h10_mlp_c_fc_w.csv,model_h10_mlp_c_proj_b.csv,model_h10_mlp_c_proj_w.csv,model_h11_attn_c_attn_b.csv,model_h11_attn_c_attn_w.csv,model_h11_attn_c_proj_b.csv,model_h11_attn_c_proj_w.csv,model_h11_ln_1_b.csv,model_h11_ln_1_g.csv,model_h11_ln_2_b.csv,model_h11_ln_2_g.csv,model_h11_mlp_c_fc_b.csv,model_h11_mlp_c_fc_w.csv,model_h11_mlp_c_proj_b.csv,model_h11_mlp_c_proj_w.csv,model_h1_attn_c_attn_b.csv,model_h1_attn_c_attn_w.csv,model_h1_attn_c_proj_b.csv,model_h1_attn_c_proj_w.csv,model_h1_ln_1_b.csv,model_h1_ln_1_g.csv,model_h1_ln_2_b.csv,model_h1_ln_2_g.csv,model_h1_mlp_c_fc_b.csv,model_h1_mlp_c_fc_w.csv,model_h1_mlp_c_proj_b.csv,model_h1_mlp_c_proj_w.csv,model_h2_attn_c_attn_b.csv,model_h2_attn_c_attn_w.csv,model_h2_attn_c_proj_b.csv,model_h2_attn_c_proj_w.csv,model_h2_ln_1_b.csv,model_h2_ln_1_g.csv,model_h2_ln_2_b.csv,model_h2_ln_2_g.csv,model_h2_mlp_c_fc_b.csv,model_h2_mlp_c_fc_w.csv,model_h2_mlp_c_proj_b.csv,model_h2_mlp_c_proj_w.csv,model_h3_attn_c_attn_b.csv,model_h3_attn_c_attn_w.csv,model_h3_attn_c_proj_b.csv,model_h3_attn_c_proj_w.csv,model_h3_ln_1_b.csv,model_h3_ln_1_g.csv,model_h3_ln_2_b.csv,model_h3_ln_2_g.csv,model_h3_mlp_c_fc_b.csv,model_h3_mlp_c_fc_w.csv,model_h3_mlp_c_proj_b.csv,model_h3_mlp_c_proj_w.csv,model_h4_attn_c_attn_b.csv,model_h4_attn_c_attn_w.csv,model_h4_attn_c_proj_b.csv,model_h4_attn_c_proj_w.csv,model_h4_ln_1_b.csv,model_h4_ln_1_g.csv,model_h4_ln_2_b.csv,model_h4_ln_2_g.csv,model_h4_mlp_c_fc_b.csv,model_h4_mlp_c_fc_w.csv,model_h4_mlp_c_proj_b.csv,model_h4_mlp_c_proj_w.csv,model_h5_attn_c_attn_b.csv,model_h5_attn_c_attn_w.csv,model_h5_attn_c_proj_b.csv,model_h5_attn_c_proj_w.csv,model_h5_ln_1_b.csv,model_h5_ln_1_g.csv,model_h5_ln_2_b.csv,model_h5_ln_2_g.csv,model_h5_mlp_c_fc_b.csv,model_h5_mlp_c_fc_w.csv,model_h5_mlp_c_proj_b.csv,model_h5_mlp_c_proj_w.csv,model_h6_attn_c_attn_b.csv,model_h6_attn_c_attn_w.csv,model_h6_attn_c_proj_b.csv,model_h6_attn_c_proj_w.csv,model_h6_ln_1_b.csv,model_h6_ln_1_g.csv,model_h6_ln_2_b.csv,model_h6_ln_2_g.csv,model_h6_mlp_c_fc_b.csv,model_h6_mlp_c_fc_w.csv,model_h6_mlp_c_proj_b.csv,model_h6_mlp_c_proj_w.csv,model_h7_attn_c_attn_b.csv,model_h7_attn_c_attn_w.csv,model_h7_attn_c_proj_b.csv,model_h7_attn_c_proj_w.csv,model_h7_ln_1_b.csv,model_h7_ln_1_g.csv,model_h7_ln_2_b.csv,model_h7_ln_2_g.csv,model_h7_mlp_c_fc_b.csv,model_h7_mlp_c_fc_w.csv,model_h7_mlp_c_proj_b.csv,model_h7_mlp_c_proj_w.csv,model_h8_attn_c_attn_b.csv,model_h8_attn_c_attn_w.csv,model_h8_attn_c_proj_b.csv,model_h8_attn_c_proj_w.csv,model_h8_ln_1_b.csv,model_h8_ln_1_g.csv,model_h8_ln_2_b.csv,model_h8_ln_2_g.csv,model_h8_mlp_c_fc_b.csv,model_h8_mlp_c_fc_w.csv,model_h8_mlp_c_proj_b.csv,model_h8_mlp_c_proj_w.csv,model_h9_attn_c_attn_b.csv,model_h9_attn_c_attn_w.csv,model_h9_attn_c_proj_b.csv,model_h9_attn_c_proj_w.csv,model_h9_ln_1_b.csv,model_h9_ln_1_g.csv,model_h9_ln_2_b.csv,model_h9_ln_2_g.csv,model_h9_mlp_c_fc_b.csv,model_h9_mlp_c_fc_w.csv,model_h9_mlp_c_proj_b.csv,model_h9_mlp_c_proj_w.csv,model_ln_f_b.csv,model_ln_f_g.csv,model_wpe.csv,model_wte.csv,vocab_bpe.csv"></csv-uploader>
<h2>Enter Your Prompt</h2>
<p> Now you're ready to run the model. </p>
<ol>
<li>Enter a prompt below or use the one predefined for you (our canonical "Mike is quick. He moves").</li>
<li>Then just click the Run button and watch the model go to work!</li>
</ol>
<div class="play-pause-button" id="globalPlayControls">
Prompt <input id="user_prompt" onchange="run_all_cells_reset()" type="text" value="Mike is quick. He moves">
<button id="reset_run_all_cells_button" onclick="run_all_cells_reset()">Reset</button>
<button id="run_all_cells_button" onclick="run_all_cells()">Run</button>
<input checked="true" id="followRunningCell" onclick="window.followRunningCell = document.querySelector('#followRunningCell').checked" type="checkbox"/>
<label for="followRunningCell">Follow</label>
<label for="jumpSelect" style="margin-left: 20px; color:white;">Jump to:</label>
<select id="jumpSelect" style="margin-left: 5px;">
<option value=""></option>
<option value="jump-matrix-operations">Matrix Operations</option>
<option value="jump-tokenization">Tokenization</option>
<option value="jump-token-embeddings">Token Embeddings</option>
<option value="jump-position-embeddings">Position Embeddings</option>
<optgroup label="Block Steps">
<option value="jump-block-input">Block Input (Step 1)</option>
<option value="jump-layer-norm-1">LayerNorm 1 (Steps 2-3)</option>
<option value="jump-attention">Attention (Steps 4-9)</option>
<option value="jump-residual-1">Residual 1 (Step 10)</option>
<option value="jump-layer-norm-2">LayerNorm 2 (Steps 11-12)</option>
<option value="jump-mlp">MLP (Steps 13-15)</option>
<option value="jump-residual-2">Residual 2 (Step 16)</option>
<option value="jump-block-iteration">Iteration</option>
</optgroup>
<optgroup label="Language Head">
<option value="jump-final-layer-norm">LayerNorm</option>
<option value="jump-unembedding">Logits</option>
<option value="jump-predicted-token">Predicted Token</option>
</optgroup>
</select>
</input></div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const jumpSelect = document.getElementById('jumpSelect');
    jumpSelect.addEventListener('change', function() {
      const targetId = this.value;
      if (!targetId) return;   // “Jump to…” placeholder selected

      // Find the target element by id
      const el = document.getElementById(targetId);
      if (!el) return;         // no such anchor

      // Smooth scroll so that the heading appears just below #globalPlayControls
      const siteHeaderOffset = document.querySelector("header").getBoundingClientRect().bottom;
      const headerOffset = document.getElementById('globalPlayControls').offsetHeight + 10;
      const elementPosition = el.getBoundingClientRect().top + window.pageYOffset;
      const offsetPosition = elementPosition - headerOffset - siteHeaderOffset;

      window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
      });

    });
  });
</script>
<h2 id="jump-matrix-operations"> Define Basic Matrix Operations </h2>
<p> This section defines some basic matrix operations. Matricies are just simple 2D JavaScript arrays.</p>
<saayn-cell id="code_for_matrix_add">
<saayn-code><script type="text/plain">

async function matrix_add(table1,table2) {

      const matrix1 = await Saayn.get_matrix_from_table(table1);
      const matrix2 = await Saayn.get_matrix_from_table(table2);
                  
      const result = [];        
      
      // Classic matrix add
      if (matrix1.length == matrix2.length) {
        for (let i = 0; i < matrix1.length; i++) {
            result[i] = [];
            for (let j = 0; j < matrix1[i].length; j++) {
              result[i][j]=Number(matrix1[i][j])+Number(matrix2[i][j]);
            }
        }

      } else if ((matrix2.length == 1 || matrix1.length == 1) && matrix1[0].length == matrix2[0].length) {
        // Fallback to row-wise matrix addition if possible
        const row = matrix1.length == 1 ? matrix1[0] : matrix2[0];
        const matrix = matrix1.length == 1 ? matrix2 : matrix1;
        
        for (let i = 0; i < matrix.length; i++) {
            result[i] = [];
            for (let j = 0; j < row.length; j++) {
              result[i][j]=Number(matrix[i][j])+Number(row[j]);
            }
        }
        
      } else {
        throw new Error('Invalid matrix dimensions for addition');
      }
    

      return result;
}
</script></saayn-code>
</saayn-cell>
<saayn-cell id="code_for_matrix_multiply">
<saayn-code><script type="text/plain">
async function matrix_multiply(table1,table2) {

      const matrix1 = await Saayn.get_matrix_from_table(table1);
      const matrix2 = await Saayn.get_matrix_from_table(table2);

      if (matrix1[0].length !== matrix2.length) {
          throw new Error('Invalid matrix dimensions for multiplication');
      }

      const result = [];
      for (let i = 0; i < matrix1.length; i++) {
          result[i] = [];
          for (let j = 0; j < matrix2[0].length; j++) {
              let sum = 0;
              for (let k = 0; k < matrix2.length; k++) {
                  sum += matrix1[i][k] * matrix2[k][j];
              }
              result[i][j] = sum;
          }
      }

      return result;
}
</script></saayn-code>
</saayn-cell>
<saayn-cell id="code_for_transpose"><saayn-code>
<script type="text/plain"> 
async function matrix_transpose(table) {    
  const matrix = await Saayn.get_matrix_from_table(table);

  return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));

}
</script>
</saayn-code></saayn-cell>
<saayn-cell id="code_for_matrix_last_row"><saayn-code>
<script type="text/plain"> 
async function matrix_last_row(table, offset) {    
  
  if(!offset) {
    offset = 0;
  }
  
  const matrix = await Saayn.get_matrix_from_table(table);

  return [[...matrix[matrix.length-1-offset]]];
}
</script>
</saayn-code></saayn-cell>
<h2 id="jump-tokenization">Tokenization Steps</h2>
<p>This section tokenizes the prompt you entered into token using the Byte Pair Encoding (BPE) algorithm.</p>
<script type="text/javascript">
async function fetch_csv(fileName, params) {
    function parseCSV(text) {
        const rows = [];
        const lines = text.split('\n');

        for (const line of lines) {
            const row = [];
            let value = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"' && line[i + 1] === '"') {
                    // Handle escaped double quotes within a quoted value
                    value += '"';
                    i++; // Skip the next quote
                } else if (char === '"') {
                    // Toggle inQuotes flag when encountering a double quote
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    // If we hit a comma and we are not within quotes, end of a value
                    if (params && params.no_trim) {
                        row.push(value);
                    } else {
                        row.push(value.trim());
                    }
                    value = '';
                } else {
                    // Append the current character to the value
                    value += char;
                }
            }

            // Push the last value in the line
            row.push(value.trim());
            rows.push(row);
        }
        return rows;
    }

    if (!params) {
        params = {};
    }

    // Access IndexedDB
    const dbRequest = indexedDB.open('CSVDatabase', 1);
    return new Promise((resolve, reject) => {
        dbRequest.onerror = (event) => {
            reject(new Error('Could not open IndexedDB: ' + event.target.errorCode));
        };

        dbRequest.onsuccess = (event) => {
            const db = event.target.result;
            const transaction = db.transaction(['csvFiles'], 'readonly');
            const objectStore = transaction.objectStore('csvFiles');
            const getRequest = objectStore.get(fileName);

            getRequest.onerror = (event) => {
                reject(new Error('Error reading from IndexedDB: ' + event.target.errorCode));
            };

            getRequest.onsuccess = (event) => {
                const result = event.target.result;
                if (!result || !result.file) {
                    reject(new Error(`File "${fileName}" not found in IndexedDB.`));
                } else {
                    const fileBlob = result.file;
                    const reader = new FileReader();
                    reader.onload = () => {
                        const csvText = reader.result;
                        const rows = parseCSV(csvText);

                        // Remove the last row if it's empty
                        if (rows.length > 0 && rows[rows.length - 1].every(cell => cell === '')) {
                            rows.pop();
                        }
                        resolve(rows);
                    };
                    reader.onerror = () => {
                        reject(new Error('Error reading file blob: ' + reader.error));
                    };
                    reader.readAsText(fileBlob);
                }
            };
        };
    });
}
</script>
<saayn-cell id="code_for_separate_into_words">
<saayn-code><script type="text/plain">

async function separate_into_words(){
  const regex = new RegExp(
      `'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+`,
      'gu'
  );
  const text = document.querySelector("#user_prompt").value
  
  const matches = text.match(regex) || [];
  return [matches];


}

</script></saayn-code>
</saayn-cell>
<saayn-cell>
<p>This step simply takes the prompt and parses it into separate words and punctuation.</p>
<saayn-sheet formula="separate_into_words()" id="separated_into_words" row_labels="['Words']">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('vocab_bpe.csv', {no_trim: true})" id="model_vocab_bpe">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('bpe_token_ids.csv', {no_trim: true})" id="bpe_token_ids"></saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_prompt_to_tokens">
<saayn-code><script type="text/plain">

async function prompt_to_tokens(params){
  const prompt_words_matrix = await Saayn.get_matrix_from_table(params.prompt);
  const vocab_bpe_matrix = await Saayn.get_matrix_from_table(params.vocab);
  const token_ids_matrix = await Saayn.get_matrix_from_table(params.token_ids);
  
  // Read the vocab_bpe into a map for easier lookup
  const vocab_bpe={};
  for(let i = 0; i < vocab_bpe_matrix.length; i++){
    if(i == 0){
      // skip the first row. it's just labels
      continue;
    }
    const left_token = vocab_bpe_matrix[i][0];
    const right_token = vocab_bpe_matrix[i][1];
    const tuple = `${left_token},${right_token}`;
    const score = vocab_bpe_matrix[i][3];
    vocab_bpe[tuple]=score;    
  }
  
  
  const number_of_words = prompt_words_matrix[0].length;
  const longest_word = prompt_words_matrix[0].reduce((longest, current) => {
      return current.length > longest.length ? current : longest;
    }, '');
    
  const offset = longest_word.length+1;
  
  const result = [];
  for(let i = 0; i < number_of_words; i++) {
    let characters = prompt_words_matrix[0][i].split('');  
    let last_characters = [];
    let pass = 0;
    for(let pass = 0; pass < longest_word.length; pass++) {
      const possible_pairs = [];
      for (let j = 0; j < characters.length - 1; j++) {
        possible_pairs.push(`${characters[j]},${characters[j + 1]}`);
      }
      
      
      const scores = possible_pairs.map(pair => vocab_bpe[pair] ? Number(vocab_bpe[pair]) : '');
      const max_score = Math.max(...scores);
      const max_index = scores.indexOf(max_score);
      const max_scores = new Array(scores.length).fill('');

      let merged = []
      if(max_index >= 0) {
        max_scores[max_index] = max_score;
        const joined = characters[max_index] + characters[max_index + 1];
        merged = [...characters.slice(0, max_index), joined, ...characters.slice(max_index + 2)];
      } else {
        merged = characters;
      }
    
      const rows_per_pass = 7;
      if(!result[pass*rows_per_pass]) {
        result[pass*rows_per_pass] = new Array(offset*number_of_words).fill('');
        result[pass*rows_per_pass+1] = new Array(offset*number_of_words).fill('');
        result[pass*rows_per_pass+2] = new Array(offset*number_of_words).fill('');
        result[pass*rows_per_pass+3] = new Array(offset*number_of_words).fill('');      
        result[pass*rows_per_pass+4] = new Array(offset*number_of_words).fill('');            
        result[pass*rows_per_pass+5] = new Array(offset*number_of_words).fill('');                  
        result[pass*rows_per_pass+6] = new Array(offset*number_of_words).fill('');                        
        result[pass*rows_per_pass][0] = `Pass ${pass}`;
        result[pass*rows_per_pass+1][0] = "Input";
        result[pass*rows_per_pass+2][0] = "Pairs";
        result[pass*rows_per_pass+3][0] = "Scores";
        result[pass*rows_per_pass+4][0] = "Max Score";      
        result[pass*rows_per_pass+5][0] = "Merged";

      }
    
      result[pass*rows_per_pass+1].splice(offset*i+1, characters.length, ...characters);
      result[pass*rows_per_pass+2].splice(offset*i+1, possible_pairs.length, ...possible_pairs);    
      result[pass*rows_per_pass+3].splice(offset*i+1, scores.length, ...scores);
      result[pass*rows_per_pass+4].splice(offset*i+1, max_scores.length, ...max_scores);    
      result[pass*rows_per_pass+5].splice(offset*i+1, merged.length, ...merged);        

      characters = merged;
    }
  }
  
  // Read in the token_ids
  const token_ids = {};
  for(let i = 0; i < token_ids_matrix.length; i++){
    const token = token_ids_matrix[i][0];
    const token_id = token_ids_matrix[i][1];
    token_ids[token]=token_id;
  }  
  
  // Append the token IDs
  const final_tokens = result[result.length-2];
  result[result.length-1][0] = "TokenID";
  for(let i = 1; i<final_tokens.length;i++) {
    if(final_tokens[i]) {
      result[result.length-1][i] = token_ids[final_tokens[i]];
    }
  }
  
  return result;
}

</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="prompt_to_tokens({ 
                      prompt:separated_into_words[], 
                      vocab: model_vocab_bpe[], 
                      token_ids: bpe_token_ids[]
                })" id="prompt_to_tokens">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_get_final_tokens"><saayn-code>
<script type="text/plain"> 
async function get_final_tokens(table) {    
  
  const matrix = await Saayn.get_matrix_from_table(table);
  
  // get the last two rows with blank cells removes
  const result = [[], []];
  
  // i = 1 to skip the first column which are labels
  for(let i = 1; i < matrix[0].length; i++) { 
    const token = matrix[matrix.length-2][i];
    const token_id = matrix[matrix.length-1][i];
    if(token) {
      result[0].push(token);
      result[1].push(token_id);
    }
  }
  
  return result;
}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet formula="get_final_tokens(prompt_to_tokens[])" id="final_tokens" row_labels="['Tokens', 'Token IDs']"></saayn-sheet>
</saayn-cell>
<h2 id="jump-token-embeddings">Tokens to token embeddings steps</h2>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_wte.csv')" id="model_wte"></saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_tokens_to_token_embeddings"><saayn-code>
<script type="text/plain"> 
async function tokens_to_token_embeddings(token_ids_table, token_embeddings_table) {    
  
  const token_ids = (await Saayn.get_matrix_from_table(token_ids_table))[0];
  const token_embeddings = await Saayn.get_matrix_from_table(token_embeddings_table);
  
  const result = new Array(token_ids.length);
  
  for(let i =0; i < token_ids.length; i++) {
    const token_id = token_ids[i];
    const embedding = token_embeddings[token_id];
    result[i] = embedding;
  }

  return result;
}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet formula="tokens_to_token_embeddings(matrix_last_row(final_tokens[]), model_wte[])" id="token_embeddings" row_labels="matrix_last_row(final_tokens[],1)"></saayn-sheet>
</saayn-cell>
<h2 id="jump-position-embeddings">Positional Embedding Steps</h2>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_wpe.csv')" id="model_wpe">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_set_constants">
<saayn-code><script type="text/plain">

(async function() {
    const prompt_matrix = await Saayn.get_matrix_from_table(document.querySelector("#token_embeddings"));
    window.prompt_token_length = prompt_matrix.length;
    window.model_head_length = 64; // Hyperparameter head size
    window.model_num_heads = 768/model_head_length; // Hyperparameter
    
})();
  
</script></saayn-code>
</saayn-cell>
<saayn-cell id="code_for_positional_embed">
<saayn-code><script type="text/plain">
async function positional_embed(table1, table2){  
  const matrix1 = table1.cells;
  const matrix2 = table2.cells;
  
  // Check if the matrices have the same number of columns
  if (matrix1[0].length !== matrix2[0].length) {
      throw new Error('Invalid matrix dimensions for addition. Matrices must have the same number of columns.');
  }
  
  // Determine the minimum number of rows (trim the longer matrix)
  const minRows = Math.min(matrix1.length, matrix2.length);

  const result = [];
  for (let i = 0; i < minRows; i++) {
      result[i] = [];
      for (let j = 0; j < matrix1[0].length; j++) {
          // Perform element-wise addition
          // Error check that both strings are valid numbers
          result[i][j] = Number(matrix1[i][j]) + Number(matrix2[i][j]);
      }
  }
  
  return result;
}

</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="positional_embed(token_embeddings[],model_wpe[])" id="position_embeddings" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h2>Block (aka "Layer") Steps</h2>
<p>The numbering of each step is designed to match the original Spreadsheets-are-all-you-need.ai Excel sheet. However, the 
numbering and breakdown of steps is arbitrary and can be rearranged.</p>
<h3>Step 0: Reset the formulas </h3>
<saayn-cell id="code_for_resetting_formulas">
<saayn-code><script type="text/plain">

// This code is only here to reset the weights if you re-run the model
// without reloading the page.
(async function() {
  // The first time through do nothing.
  if(!window.saaynHasRun) {
    window.saaynHasRun = true;
  } else {
    // Because we recycle the sheet components in each pass of the Block/Layer, the
    // formulas are now configured for the last Block/Layer. So reset all the formulas 
    // back to using the weights for the first layer/block (i.e. "_h0_").
    const all_sheets = document.querySelectorAll('saayn-sheet');
  	for(let i = 0; i < all_sheets.length;i++) {
  		const sheet = all_sheets[i];
  		const formula_box = sheet.shadowRoot.querySelector(".formula-box");
  		if(sheet.getAttribute("id") == "block_step_1") {
        //The first sheet should get the output of the position embeddings stesp.
  			formula_box.value = "copy_table(position_embeddings[])";
  		} else {
        // Update the formulas back to the h0 blocks/layer weights
  			formula_box.value = formula_box.value.replace(/model_h\d+_/, "model_h0_");
  		}
  	}
  } 
})();
</script></saayn-code>
</saayn-cell>
<h3 id="jump-block-input">Step 1: Get the input embedding</h3>
<saayn-cell id="code_for_copy_table">
<saayn-code><script type="text/plain">
async function copy_table(table1){  
  return table1.cells;
}
</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="copy_table(position_embeddings[])" id="block_step_1" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-layer-norm-1">Steps 2 - 3: First LayerNorm</h3>
<saayn-cell id="code_for_normalize_by_row">
<saayn-code>
<script type="text/plain">
      async function normalize_by_row(table1){  
          
          function normalize_row(range) {
              // Calculate the average
              const avg = range.reduce((acc, val) => acc + val, 0) / range.length;

              // Calculate the variance (Population variance)
              const variance = range.reduce((acc, val) => acc + Math.pow(val - avg, 2), 0) / range.length;

              // Perform normalization on each element in the range
              return range.map(val => (val - avg) / Math.sqrt(variance + 0.00001));
          }
          
          const matrix = table1.cells;
          const result =[];
          for(var i = 0; i < matrix.length; i++) {
            result[i]=normalize_row(matrix[i])
          }
          
          return result;
      }
      
      
    </script>
</saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="normalize_by_row(block_step_1[])" id="block_step_2" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_ln_1_g.csv')" id="layernorm_1_gain">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_ln_1_b.csv')" id="layernorm_1_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_layernorm_gain_and_bias">
<saayn-code>
<script type="text/plain">
      async function layernorm_gain_and_bias(data_table,gain_table,bias_table){  
          
          const data = data_table.cells;
          const gain = gain_table.cells;
          const bias = bias_table.cells;
          const result =[];
          
          const height = data.length;
          const width = data[0].length;
          
          for(var i = 0; i < height; i++) {
            for(var j = 0; j < width; j++) {
              if(0==j) {
                result[i] =[]
              }
              result[i][j]= Number(data[i][j]) * Number(gain[0][j]) + Number(bias[0][j]);
            }
          }
          
          return result;
      }
      
      
    </script>
</saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="layernorm_gain_and_bias(block_step_2[],layernorm_1_gain[],layernorm_1_bias[])" id="block_step_3" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-attention">Steps 4 - 9: Multi-head attention</h3>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_attn_c_attn_w.csv')" id="attention_weight_matrix">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_attn_c_attn_b.csv')" id="attention_bias_matrix">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="matrix_add(matrix_multiply(block_step_3[],attention_weight_matrix[]), attention_bias_matrix[])" id="block_step_4">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_extract_matrix">
<saayn-code><script type="text/plain">

async function extract_submatrix(table, start_column, end_column) {

  const matrix = await Saayn.get_matrix_from_table(table);
      const result = [];
      
      for (let i = 0; i < matrix.length; i++) {
          result[i] = [];
          // we need separate src_column and dest_column because the 
          // source starts at an arbitrary column number but the
          // destination matrix always starts at 0
          for (let src_column = start_column, dest_column = 0; src_column < matrix[i].length && src_column < end_column; dest_column++, src_column++) {
            result[i][dest_column]=matrix[i][src_column];
          }
      }

      return result;
}
</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="extract_submatrix(block_step_4[],0,768)" id="block_step_5_queries" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="extract_submatrix(block_step_4[],768,768*2)" id="block_step_5_keys" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="extract_submatrix(block_step_4[],768*2,768*3)" id="block_step_5_values" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_create_triangle_matrix">
<saayn-code><script type="text/plain">

function createUpperTriangularMatrix(size) {
      
    const height = size;
    const width = size;
    // Initialize the matrix with zeros
    const matrix = Array.from({ length: height }, () => Array(width).fill(0));

    // Iterate over the rows
    for (let i = 0; i < height; i++) {
      // Iterate over the columns, starting from the element above the diagonal
      for (let j = i + 1; j < width; j++) {
        matrix[i][j] = -1e10;
      }
    }

    return matrix;
  }
    
</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="createUpperTriangularMatrix(prompt_token_length)" id="triangle_matrix">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_multihead_matrix_multiply">
<saayn-code><script type="text/plain"> 
async function multihead_matrix_multiply(queries_table, keys_table, mask_table) {

    const queries_matrix = await Saayn.get_matrix_from_table(queries_table);
    const keys_matrix = await Saayn.get_matrix_from_table(keys_table);
    const mask_matrix = await Saayn.get_matrix_from_table(mask_table);    
    
    const result = Array.from({ length: window.prompt_token_length }, () => Array(768).fill(0.0));

    for(let head = 0; head < window.model_num_heads; head++) {
      const head_offset = head*window.model_head_length;
      for(let i = 0; i < window.prompt_token_length; i++ ) {
        for(let j = 0; j < window.prompt_token_length; j++) {
          for(let k = 0; k < window.model_head_length; k++) {
            result[i][j+head_offset] += (Number(queries_matrix[i][k+head_offset]) * Number(keys_matrix[j][k+head_offset]))/Math.sqrt(window.model_head_length);
          }
          
          // Add (typically triangular) causal mask.
          result[i][j+head_offset] += mask_matrix[i][j];
        }
      }
    }

    return result;
}
</script></saayn-code>
</saayn-cell>
<saayn-cell>
<saayn-sheet column_labels="matrix_last_row(final_tokens[],1)" formula="multihead_matrix_multiply(block_step_5_queries[],block_step_5_keys[], triangle_matrix[])" id="block_step_6" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_softmax"><saayn-code>
<script> 

function softmax(arr) {
  // Find the maximum value in the array for numerical stability
  const maxVal = Math.max(...arr);

  // Compute the exponentials and their sum
  const expValues = arr.map(value => Math.exp(value - maxVal));
  const sumExp = expValues.reduce((acc, curr) => acc + curr, 0);

  // Compute the softmax values
  return expValues.map(value => value / sumExp);
}

async function multihead_softmax(table) {    
    const result = Array.from({ length: window.prompt_token_length }, () => Array(768).fill(0.0));

    const matrix = await Saayn.get_matrix_from_table(table);
    
    for(let row = 0; row < matrix.length; row++) {
      for(let head = 0; head < window.model_num_heads; head++) {
        const head_offset = head*window.model_head_length;
        const head_row = matrix[row].slice(head_offset, head_offset+window.prompt_token_length);
        const softmax_head_row = softmax(head_row);
        result[row].splice(head_offset, window.prompt_token_length, ...softmax_head_row)
      }
    }

    return result;
}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet column_labels="matrix_last_row(final_tokens[],1)" formula="multihead_softmax(block_step_6[])" id="block_step_7" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_multihead_matrix_multiply2"><saayn-code>
<script> 

async function multihead_matrix_multiply2(table1, table2) {    

  const matrix1 = await Saayn.get_matrix_from_table(table1);
  const matrix2 = await Saayn.get_matrix_from_table(table2);
  
  const result = Array.from({ length: window.prompt_token_length }, () => Array(768).fill(0.0));

  for(let head = 0; head < window.model_num_heads; head++) {
    const head_offset = head*window.model_head_length;
    for(let i = 0; i < window.prompt_token_length; i++ ) {
      for(let j = 0; j < window.model_head_length; j++) {
        for(let k = 0; k < window.prompt_token_length; k++) {
          result[i][j+head_offset] += (Number(matrix1[i][k+head_offset]) * Number(matrix2[k][j+head_offset]));
        }
      }
    }
  }

  return result;
}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet formula="multihead_matrix_multiply2(block_step_7[],block_step_5_values[])" id="block_step_8">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_attn_c_proj_w.csv')" id="attention_projection_weights">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_attn_c_proj_b.csv')" id="attention_projection_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="matrix_add(matrix_multiply(block_step_8[],attention_projection_weights[]),attention_projection_bias[])" id="block_step_9" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-residual-1">Step 10: Residual Connection</h3>
<saayn-cell>
<saayn-sheet formula="matrix_add(block_step_9[], block_step_1[])" id="block_step_10" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-layer-norm-2">Steps 11 - 12: Second LayerNorm</h3>
<saayn-cell>
<saayn-sheet formula="normalize_by_row(block_step_10[])" id="block_step_11" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_ln_2_g.csv')" id="layernorm_2_gain">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_ln_2_b.csv')" id="layernorm_2_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="layernorm_gain_and_bias(block_step_11[],layernorm_2_gain[],layernorm_2_bias[])" id="block_step_12" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-mlp">Steps 13 - 15: Multilayer Perceptron</h3>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_mlp_c_fc_w.csv')" id="mlp_fc_weights">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_mlp_c_fc_b.csv')" id="mlp_fc_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="matrix_add(matrix_multiply(block_step_12[], mlp_fc_weights[]), mlp_fc_bias[])" id="block_step_13">
</saayn-sheet>
</saayn-cell>
<saayn-cell id="code_for_gelu"><saayn-code>
<script type="text/plain"> 

async function gelu(table) {    

  const matrix = await Saayn.get_matrix_from_table(table);
  
  const gelu_function = x => 0.5 * x * (1 + Math.tanh(Math.sqrt(2 / Math.PI) * (x + 0.044715 * Math.pow(x, 3))));
  
  const result = Array.from({ length: window.prompt_token_length }, () => Array(768).fill(0.0));
  
  for(let i = 0; i < matrix.length; i++) {
    for(let j = 0; j < matrix[0].length; j++) {
      result[i][j] = gelu_function(matrix[i][j]);
    }
  }

  return result;
}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet formula="gelu(block_step_13[])" id="block_step_14">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_mlp_c_proj_w.csv')" id="mlp_proj_weights">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_h0_mlp_c_proj_b.csv')" id="mlp_proj_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="matrix_add(matrix_multiply(block_step_14[], mlp_proj_weights[]), mlp_proj_bias[])" id="block_step_15" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h3 id="jump-residual-2">Steps 16: Second Residual Connection</h3>
<saayn-cell>
<saayn-sheet formula="matrix_add(block_step_15[], block_step_10[])" id="block_step_16" row_labels="matrix_last_row(final_tokens[],1)">
</saayn-sheet>
</saayn-cell>
<h2 id="jump-block-iteration">Run all the Block steps again for 11 more times</h2>
<saayn-cell id="code_for_iterate_blocks"><saayn-code>
<script type="text/plain"> 
async function iterate_blocks(startElement, endElement, iterations) {    
  
  const execution_log = document.querySelector("#code_for_run_iterate_blocks").shadowRoot.querySelector(".log-output");
  
  // Retrieve all sheet elements 
  const allElements = document.querySelectorAll('saayn-sheet');

  // Initialize a flag to track when we are in the active range of cells
  let withinRange = false;

  // Run multiple iterations of each block
  // NOTE!!! we start with i = 1 since 0th iteration already ran (when the cells before us ran)
  let i = 1; 
  while(i<iterations) {
    
    // Play nice with global play controls managed by window.runAllCellsState
    if(window.runAllCellsState == "pause") {
      await sleep(500);
      continue;
    } else if(window.runAllCellsState == "reset") {
      break;
    }

    // For each iteration, run all the cells between startElement
    // and endElement
    let j = 0;
    while(j < allElements.length) {
      
      // Play nice with global play controls managed by window.runAllCellsState
      if(window.runAllCellsState == "pause") {
        await sleep(500);
        continue;
      } else if(window.runAllCellsState == "reset") {
        break;
      }      
      
      // Get all the elements
      let element = allElements[j];
      
      // Start processing when the start element is reached
      if (element === startElement) {
        withinRange = true; 
        
      }

      if (withinRange) {
        // Update the cell formula to pull the weights 
        // for this Block/Layer number
        const formula_box = element.shadowRoot.querySelector(".formula-box");
        if(element == startElement){
          formula_box.value = `copy_table(block_step_16[])`;
        } else {
          formula_box.value = formula_box.value.replace(`model_h${i-1}_`, `model_h${i}_`);
        }
        
        // Run the cell
        let status = await element.parentElement.runCell();
        
        // Display progress
        execution_log.innerHTML += ".";
      }

      // Stop processing after the end element is reached
      if (element === endElement) {
        withinRange = false; 
      }
     
      j++;
    }

    // Display progress
    execution_log.innerHTML += `Completed Block ${i} \n`;
    i++;
  }
}
</script>
</saayn-code></saayn-cell>
<saayn-cell id="code_for_run_iterate_blocks"><saayn-code>
<script type="text/plain"> 
(async function() {
  // Re run the block steps 1 through 16. 
  // Do that 11 more times
  const start = document.querySelector("#block_step_1");
  const end = document.querySelector("#block_step_16");
  await iterate_blocks(start,end,12);    
})();
</script>
</saayn-code></saayn-cell>
<h2 id="jump-final-layer-norm">Final LayerNorm</h2>
<saayn-cell>
<saayn-sheet formula="matrix_last_row(block_step_16[])" id="last_hidden_state">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="normalize_by_row(last_hidden_state[])" id="last_layernorm">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_ln_f_g.csv')" id="layernorm_gain">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="fetch_csv('model_ln_f_b.csv')" id="layernorm_bias">
</saayn-sheet>
</saayn-cell>
<saayn-cell>
<saayn-sheet formula="layernorm_gain_and_bias(last_layernorm[],layernorm_gain[],layernorm_bias[])" id="predicted_embedding">
</saayn-sheet>
</saayn-cell>
<h2 id="jump-unembedding">Unembedding into Logits</h2>
<saayn-cell>
<saayn-sheet formula="matrix_multiply(model_wte[],matrix_transpose(predicted_embedding[]))" id="logits"></saayn-sheet>
</saayn-cell>
<h2 id="jump-predicted-token">Logits into predicted token</h2>
<saayn-cell id="code_for_predicted_token"><saayn-code>
<script type="text/plain"> 
async function predicted_token(params) {    
  
  const logits = await Saayn.get_matrix_from_table(params.logits);
  const token_map = await Saayn.get_matrix_from_table(params.token_map);

  // Find the max logit and it's index
  let max = -Infinity;
  let maxIndex = -1;
  for (let i = 0; i < logits.length; i++) {
      if (logits[i][0] > max) {
          max = logits[i][0];
          maxIndex = i;
      }
  }
  
  // The index tells 
  const predicted_token = token_map[maxIndex][0];

  return [
    ["Maximum logit value:", max],
    ["Token ID:", maxIndex],
    ["Predicted Token:", predicted_token]
  ];

}
</script>
</saayn-code></saayn-cell>
<saayn-cell>
<saayn-sheet formula="predicted_token({logits: logits[], token_map: bpe_token_ids[]})" id="predicted_token"></saayn-sheet>
</saayn-cell>
</div>
<h2>Achievement Unlocked!</h2>
<div class="highlight" id="mc_embed_shell">
<style type="text/css">
/* MailChimp Form Embed Code - Classic - 12/17/2015 v10.7 */
#mc_embed_signup form {display:block; position:relative; text-align:left; margin: 20px}
#mc_embed_signup h2 {font-weight:bold; padding:0; margin:15px 0; font-size:1.4em;}
#mc_embed_signup input {border: 1px solid #ABB0B2; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px;}
#mc_embed_signup input[type=checkbox]{-webkit-appearance:checkbox;}
#mc_embed_signup input[type=radio]{-webkit-appearance:radio;}
#mc_embed_signup input:focus {border-color:#333;}
#mc_embed_signup .button {clear:both; background-color: #111; border: 0 none; border-radius:4px; transition: all 0.23s ease-in-out 0s; color: #FFFFFF; cursor: pointer; display: inline-block; font-size:15px; font-weight: normal; height: 32px; line-height: 32px; margin: 0 5px 10px 0; padding: 0 22px; text-align: center; text-decoration: none; vertical-align: top; white-space: nowrap; width: fit-content; width: -moz-fit-content;}
#mc_embed_signup .button:hover {background-color:#222;}
#mc_embed_signup .small-meta {font-size: 11px;}
#mc_embed_signup .nowrap {white-space:nowrap;}

#mc_embed_signup .mc-field-group {clear:left; position:relative; width:96%; padding-bottom:3%; min-height:50px; display:grid;}
#mc_embed_signup .size1of2 {clear:none; float:left; display:inline-block; width:46%; margin-right:4%;}
* html #mc_embed_signup .size1of2 {margin-right:2%; /* Fix for IE6 double margins. */}
#mc_embed_signup .mc-field-group label {display:block; margin-bottom:3px;}
#mc_embed_signup .mc-field-group input {display:block; width:100%; padding:8px 0; text-indent:2%;}
#mc_embed_signup .mc-field-group select {display:inline-block; width:99%; padding:5px 0; margin-bottom:2px;}
#mc_embed_signup .mc-address-fields-group {display:flex; flex-direction:row; justify-content:space-evenly; width:96%; gap:15px;}
#mc_embed_signup .mc-sms-phone-group {display:flex; flex-direction:row; justify-content:space-evenly; width:96%; gap:15px; padding-top:5px;}

#mc_embed_signup .datefield, #mc_embed_signup .phonefield-us{padding:5px 0;}
#mc_embed_signup .datefield input, #mc_embed_signup .phonefield-us input{display:inline; width:60px; margin:0 2px; letter-spacing:1px; text-align:center; padding:5px 0 2px 0;}
#mc_embed_signup .phonefield-us .phonearea input, #mc_embed_signup .phonefield-us .phonedetail1 input{width:40px;}
#mc_embed_signup .datefield .monthfield input, #mc_embed_signup .datefield .dayfield input{width:30px;}
#mc_embed_signup .datefield label, #mc_embed_signup .phonefield-us label{display:none;}

#mc_embed_signup .indicates-required {text-align:right; font-size:11px; margin-right:4%;}
#mc_embed_signup .asterisk {color:#e85c41; font-size:150%; font-weight:normal; position:relative; top:5px;}     
#mc_embed_signup .clear {clear:both;}
#mc_embed_signup .foot {display:grid; grid-template-columns: 3fr 1fr; width:96%; align-items: center;}
@media screen and (max-width:400px) {#mc_embed_signup .foot {display:grid; grid-template-columns: 1fr; width:100%; align-items: center;}}

@media screen and (max-width:400px) {#mc_embed_signup .referralBadge {width:50%;}}

#mc_embed_signup .brandingLogo {justify-self:right;}
@media screen and (max-width:400px) {#mc_embed_signup .brandingLogo {justify-self:left;}}

#mc_embed_signup .mc-field-group.input-group ul {margin:0; padding:5px 0; list-style:none;}
#mc_embed_signup .mc-field-group.input-group ul li {display:block; padding:3px 0; margin:0;}
#mc_embed_signup .mc-field-group.input-group label {display:inline;}
#mc_embed_signup .mc-field-group.input-group input {display:inline; width:auto; border:none;}

#mc_embed_signup div#mce-responses {float:left; top:-1.4em; padding:0em .5em 0em .5em; overflow:hidden; width:90%; margin: 0 5%; clear: both;}
#mc_embed_signup div.response {margin:1em 0; padding:1em .5em .5em 0; font-weight:bold; float:left; top:-1.5em; z-index:1; width:80%;}
#mc_embed_signup #mce-error-response {display:none;}
#mc_embed_signup #mce-success-response {color:#529214; display:none;}
#mc_embed_signup label.error {display:block; float:none; width:auto; margin-left:1.05em; text-align:left; padding:.5em 0;}
#mc_embed_signup .helper_text {color: #8d8985; margin-top: 2px; display: inline-block; padding: 3px; background-color: rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size: 14px; font-weight: normal; z-index: 1;}

#mc-embedded-subscribe {clear:both; width:auto; display:block; margin:1em 0 1em 5%;}
#mc_embed_signup #num-subscribers {font-size:1.1em;}
#mc_embed_signup #num-subscribers span {padding:.5em; border:1px solid #ccc; margin-right:.5em; font-weight:bold;}

#mc_embed_signup #mc-embedded-subscribe-form div.mce_inline_error {display:inline-block; margin:2px 0 1em 0; padding:3px; background-color:rgba(255,255,255,0.85); -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; font-size:14px; font-weight:normal; z-index:1; color:#e85c41;}
#mc_embed_signup #mc-embedded-subscribe-form input.mce_inline_error {border:2px solid #e85c41;}	
        #mc_embed_signup{false;clear:left; font:14px Helvetica,Arial,sans-serif; width: px;}
        /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
           We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://spreadsheets-are-all-you-need.us21.list-manage.com/subscribe/post?u=96d33fd949860389358a81747&amp;id=c84c7806a0&amp;f_id=007780e6f0" class="validate" id="mc-embedded-subscribe-form" method="post" name="mc-embedded-subscribe-form" novalidate="" target="_self">
<div id="mc_embed_signup_scroll"><h2>If you've gotten this far in using Spreadsheets-are-all-you-need then you'll definitely love what's coming next. Subscribe so you don't miss it!</h2>
<div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input class="required email" id="mce-EMAIL" name="EMAIL" required="" type="email" value=""/></div>
<div hidden=""><input name="tags" type="hidden" value="2992962"/></div>
<div class="clear" id="mce-responses">
<div class="response" id="mce-error-response" style="display: none;"></div>
<div class="response" id="mce-success-response" style="display: none;"></div>
</div><div aria-hidden="true" style="position: absolute; left: -5000px;"><input name="b_96d33fd949860389358a81747_c84c7806a0" tabindex="-1" type="text" value=""/></div><div class="clear"><input class="button" id="mc-embedded-subscribe" name="subscribe" type="submit" value="Subscribe"/></div>
</div>
</form>
</div>
</div>
</div>
</article>
</main>
</div>
</div>
</div>
<footer class="site-footer" id="colophon" role="contentinfo">
<div class="footer-connect">
<div class="container">
<div class="row">
<div class="col-md-4 offset-md-2 col-sm-6 offset-md-0">
<div class="footer-subscribe">
<h5 class="follow-heading">Join the Newsletter</h5> <form action="https://spreadsheets-are-all-you-need.us21.list-manage.com/subscribe/post?u=96d33fd949860389358a81747&amp;id=c84c7806a0&amp;f_id=007de5e6f0" class="" id="mc-embedded-subscribe-form" method="post" name="mc-embedded-subscribe-form" novalidate="" target="_blank">
<input class="subs_input" id="mce-EMAIL" name="EMAIL" placeholder="Enter your e-mail address" type="text" value=""/>
<input class="subs-button" name="subscribe" type="submit" value="Subscribe"/>
</form>
</div>
</div>
<div class="col-md-4 col-sm-6">
<div class="footer-social">
<h5 class="follow-heading">Keep Updated</h5><div class="footer-social-icons"><a href="https://x.com/ianand" target="_blank" title="Twitter"><i class="fa fa-brands fa-x-twitter"></i></a><a href="https://www.linkedin.com/in/ishananand/" target="_blank" title="LinkedIn"><i class="fa fa-brands fa-linkedin-in"></i></a></div> </div>
</div>
</div>
</div>
</div>
<div class="site-info">
<div class="container">
<div class="btt">
<a class="back-to-top" href="#page" title="Back To Top"><i class="fa fa-angle-double-up wow flash" data-wow-duration="2s"></i></a>
</div>
								Copyright © 2025 Spreadsheets are all you need.ai			</div>
</div>
</footer>
</div>
<script type="speculationrules">
{"prefetch":[{"source":"document","where":{"and":[{"href_matches":"\/*"},{"not":{"href_matches":["\/wp-*.php","\/wp-admin\/*","\/wp-content\/uploads\/*","\/wp-content\/*","\/wp-content\/plugins\/*","\/wp-content\/themes\/onepress\/*","\/*\\?(.+)"]}},{"not":{"selector_matches":"a[rel~=\"nofollow\"]"}},{"not":{"selector_matches":".no-prefetch, .no-prefetch a"}}]},"eagerness":"conservative"}]}
</script>
<script id="onepress-theme-js-extra" type="text/javascript">
/* <![CDATA[ */
var onepress_js_settings = {"onepress_disable_animation":"","onepress_disable_sticky_header":"","onepress_vertical_align_menu":"","hero_animation":"flipInX","hero_speed":"5000","hero_fade":"750","submenu_width":"0","hero_duration":"5000","hero_disable_preload":"","disabled_google_font":"","is_home":"","gallery_enable":"","is_rtl":"","parallax_speed":"0.5"};
/* ]]> */
</script>
<script id="onepress-theme-js" src="https://spreadsheets-are-all-you-need.ai/wp-content/themes/onepress/assets/js/theme-all.min.js" type="text/javascript"></script>

<!-- Fathom - beautiful, simple website analytics -->
<script data-site="YFMHMTBX" defer="" src="https://cdn.usefathom.com/script.js"></script>
<!-- / Fathom -->
</body>
</html>
